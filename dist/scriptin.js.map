{"version":3,"file":"scriptin.js","sources":["../src/lib/ajax.js","../src/lib/events.js","../src/lib/store/dbs/indexed-db.js","../src/lib/store/dbs/localstorage.js","../src/lib/store/index.js","../src/lib/utils/dateFns.js","../src/lib/utils/general.js","../src/index.js","../src/lib/utils/headers.js"],"sourcesContent":["/**\n * Copyright (c) 2023 Anthony Mugendi\n *\n * This software is released under the MIT License.\n * https://opensource.org/licenses/MIT\n */\n\n// Ref:https://gist.github.com/Danilovonline/1b87ef2ff1b1e0b19714a8b2e6246856\nfunction httpRequest(\n  url,\n  method,\n  data,\n  opts,\n  success_callback,\n  failure_callback\n) {\n  var xhr;\n\n  // defaults options\n  var defaultOpts = { headers: {} };\n\n  method = method.toUpperCase();\n\n  // for post/put methods\n  if (['POST', 'PUT'].indexOf(method) > -1) {\n    defaultOpts.headers['content-type'] = 'application/json';\n  }\n\n  opts = Object.assign(defaultOpts, opts);\n\n  var headers = {};\n\n  for (var k in opts.headers) {\n    headers[k.toLowerCase()] = opts.headers[k];\n  }\n\n  var data2 = [];\n  if (typeof data == 'object') {\n    // format data\n    if (headers['content-type'] == 'application/json') {\n      data = JSON.stringify(data);\n    } else {\n      for (var index in data) {\n        if (data.hasOwnProperty(index)) {\n          data2[data2.length] = index + '=' + data[index];\n        }\n      }\n      data = data2.join('&');\n    }\n  }\n  if (typeof XMLHttpRequest !== 'undefined') {\n    xhr = new XMLHttpRequest();\n  } else {\n    var versions = [\n      'MSXML2.XmlHttp.5.0',\n      'MSXML2.XmlHttp.4.0',\n      'MSXML2.XmlHttp.3.0',\n      'MSXML2.XmlHttp.2.0',\n      'Microsoft.XmlHttp',\n    ];\n\n    for (var i = 0, len = versions.length; i < len; i++) {\n      try {\n        xhr = new ActiveXObject(versions[i]);\n        break;\n      } catch (e) {}\n    } // end for\n  }\n\n  var ua = navigator.userAgent.toLowerCase();\n\n  xhr.onreadystatechange = function () {\n    // https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/getAllResponseHeaders\n    if (this.readyState === this.HEADERS_RECEIVED) {\n      // Get the raw header string\n      var headers = xhr.getAllResponseHeaders();\n      // Convert the header string into an array\n      // of individual headers\n      var arr = headers.trim().split(/[\\r\\n]+/);\n\n      // Create a map of header names to values\n      var headerMap = {};\n      arr.forEach(function (line) {\n        var parts = line.split(': ');\n        var header = parts.shift().toLowerCase();\n        var value = parts.join(': ');\n        headerMap[header] = value;\n      });\n\n      // console.log(headerMap['content-type']);\n\n      xhr.headers = headerMap;\n    }\n  };\n\n  if (\n    ua.indexOf('msie') != -1 &&\n    ua.indexOf('opera') == -1 &&\n    ua.indexOf('webtv') == -1\n  ) {\n    xhr.onreadystatechange = function () {\n      if (this.readyState === 4) {\n        if (this.status >= 200 && this.status < 400) {\n          // Success!\n          success_callback(xhr);\n        } else {\n          // Error :(\n          failure_callback(xhr);\n        }\n      }\n    };\n  } else {\n    xhr.onload = function (e) {\n      if (this.status == 200) {\n        // console.log(xhr.data);\n        success_callback(xhr);\n      } else {\n        failure_callback(xhr);\n      }\n    };\n  }\n\n  if (!method) {\n    method = 'GET';\n  }\n\n  method = method.toUpperCase();\n\n  // console.log({method});\n\n  xhr.open(method, url, true);\n\n  // console.log('TTT', url, opts);\n\n  if (opts.responseType) {\n    xhr.responseType = opts.responseType;\n  }\n  //\n\n  for (var key in headers) {\n    xhr.setRequestHeader(key, headers[key]);\n  }\n\n  xhr.send(data);\n}\n\nclass Ajax {\n  constructor({ methods = ['get', 'post', 'head', 'put', 'post'] } = {}) {\n    var self = this;\n\n    methods.forEach(function (method) {\n      self[method] = function (url, data, opts = {}) {\n        return this.__fetch(url, method, data, opts);\n      };\n    });\n  }\n\n  __fetch(url, method, data, opts) {\n    // console.log({data});\n    return new Promise(function (resolve, reject) {\n      httpRequest(\n        url,\n        method,\n        data,\n        opts,\n        function (xhr) {\n          // console.log(\">>>>\", xhr.response==xhr.responseText);\n          // console.log(xhr);\n          resolve({ data: xhr.response, headers: xhr.headers });\n        },\n        reject\n      );\n    });\n  }\n}\n\nexport default new Ajax();\n","/**\n * Copyright (c) 2024 Anthony Mugendi\n * \n * This software is released under the MIT License.\n * https://opensource.org/licenses/MIT\n */\n\n//source: https://github.com/chrisdavies/eev\n\nexport default (function () {\n    var id = 0;\n    var splitter = /[\\s,]+/g;\n  \n    // A relatively generic LinkedList impl\n    function LinkedList(linkConstructor) {\n      this.head = new RunnableLink();\n      this.tail = new RunnableLink(this.head);\n      this.head.next = this.tail;\n      this.linkConstructor = linkConstructor;\n      this.reg = {};\n    }\n  \n    LinkedList.prototype = {\n      insert: function (data) {\n        var link = new RunnableLink(this.tail.prev, this.tail, data);\n        link.next.prev = link.prev.next = link;\n        return link;\n      },\n  \n      remove: function (link) {\n        link.prev.next = link.next;\n        link.next.prev = link.prev;\n      }\n    };\n  \n    // A link in the linked list which allows\n    // for efficient execution of the callbacks\n    function RunnableLink(prev, next, fn) {\n      this.prev = prev;\n      this.next = next;\n      this.fn = fn || noop;\n    }\n  \n    RunnableLink.prototype.run = function (data) {\n      this.fn(data);\n      this.next && this.next.run(data);\n    };\n  \n    function noop () { }\n  \n    function Eev () {\n      this.events = {};\n    }\n  \n    Eev.prototype = {\n      constructor: Eev,\n  \n      on: function (names, fn) {\n        var me = this;\n  \n        names.split(splitter).forEach(function (name) {\n          var list = me.events[name] || (me.events[name] = new LinkedList());\n          var eev = fn._eev || (fn._eev = (++id));\n  \n          list.reg[eev] || (list.reg[eev] = list.insert(fn));\n        });\n      },\n  \n      off: function (names, fn) {\n        var me = this;\n        fn && names.split(splitter).forEach(function (name) {\n          var list = me.events[name];\n  \n          if (!list) {\n            return;\n          }\n  \n          var link = list.reg[fn._eev];\n  \n          list.reg[fn._eev] = undefined;\n  \n          list && link && list.remove(link);\n        });\n      },\n  \n      emit: function (name, data) {\n        var evt = this.events[name];\n        evt && evt.head.run(data);\n      }\n    };\n  \n    return Eev;\n  }());","\nexport default class DbStorage {\n  constructor(options) {\n    this.name = options.name;\n  }\n\n  getItem(key) {\n    return this.__getStore().then((store) => {\n      return awaitRequest(store.get(key), 'Failed to get item');\n    });\n  }\n\n  setItem(key, value) {\n    return this.__getStore().then((store) => {\n      return awaitRequest(store.put(value, key), 'Failed to set item');\n    });\n  }\n\n  removeItem(key) {\n    return this.__getStore().then((store) => {\n      return awaitRequest(store.delete(key), 'Failed to remove item');\n    });\n  }\n\n  clear() {\n    return this.__getStore().then((store) => {\n      return awaitRequest(store.clear(), 'Failed to clear store');\n    });\n  }\n\n  __getStore() {\n    return this.__getOrCreateDb().then((db) => {\n      return db.transaction('store', 'readwrite').objectStore('store');\n    });\n  }\n\n  __getOrCreateDb() {\n    if (this.db === undefined) {\n      this.db = this.__openDb();\n    }\n    return this.db;\n  }\n\n  __openDb() {\n    var request = indexedDB.open(this.name, 1);\n\n    request.addEventListener('upgradeneeded', function () {\n      // e.oldVersion\n      // e.newVersion\n      var db = request.result;\n      db.createObjectStore('store');\n    });\n\n    return awaitRequest(request, 'Failed to open IndexedDB');\n  }\n}\n\n\nfunction awaitRequest(request, errorMessage) {\n  return new Promise(function (resolve, reject) {\n    request.addEventListener('success', function () {\n      resolve(request.result);\n    });\n    request.addEventListener('error', function () {\n      reject(errorMessage);\n    });\n  });\n}\n","// wrapper for localstorage to enable domain based storage\n\nexport default class LocalStorage {\n  constructor(options) {\n    this.name = options.name;\n\n    var methods = ['getItem', 'setItem', 'removeItem', 'clear'];\n\n    for (var i in methods) {\n      this[methods[i]] = function (methodName) {\n        var args = arguments;\n        var key = this.__formatKey(args[1]);\n        var value = args[2];\n        var resp;\n\n        if (value) {\n          value = JSON.stringify(value);\n        }\n\n        if (value) {\n          resp = localStorage[methodName](key, value);\n        } else {\n          resp = localStorage[methodName](key);\n        }\n\n        if (resp) {\n          resp = JSON.parse(resp);\n        }\n\n        return resp;\n      }.bind(this, methods[i]);\n    }\n  }\n\n  __formatKey(key) {\n    return [this.name, key].join(':');\n  }\n}\n","/**\n * Copyright (c) 2024 Anthony Mugendi\n *\n * This software is released under the MIT License.\n * https://opensource.org/licenses/MIT\n */\n\n'use strict';\n\nimport DbStorage from './dbs/indexed-db.js';\nimport LocalStorage from './dbs/localstorage.js';\n\n\nclass Store {\n  constructor(options = {}) {\n    this.options = Object.assign(\n      { name: window.location.host, debug: false },\n      options\n    );\n    // initialize store\n    return this.initStore();\n  }\n\n  initStore() {\n    var indexedDB =\n      window.indexedDB ||\n      window.webkitIndexedDB ||\n      window.mozIndexedDB ||\n      window.msIndexedDB;\n\n    var db;\n\n    if (indexedDB) {\n      db = new DbStorage(this.options);\n      db.dbType = 'indexedDB';\n    } else if (window.localStorage) {\n      db = new LocalStorage(this.options);\n      db.dbType = 'localStorage';\n    }\n\n    if (this.options.debug) {\n      console.log(`Database Used: `, db.dbType);\n    }\n\n    return db;\n  }\n}\n\nexport default Store;\n","export function toDate(argument) {\n  var argStr = Object.prototype.toString.call(argument);\n\n  // Clone the date\n  if (\n    argument instanceof Date ||\n    (typeof argument === 'object' && argStr === '[object Date]')\n  ) {\n    // Prevent the date to lose the milliseconds when passed to new Date() in IE10\n    return new argument.constructor(+argument);\n  } else if (\n    typeof argument === 'number' ||\n    argStr === '[object Number]' ||\n    typeof argument === 'string' ||\n    argStr === '[object String]'\n  ) {\n    // TODO: Can we get rid of as?\n    return new Date(argument);\n  } else {\n    // TODO: Can we get rid of as?\n    return new Date(NaN);\n  }\n}\n\nexport function constructFrom(date, value) {\n  if (date instanceof Date) {\n    return new date.constructor(value);\n  } else {\n    return new Date(value);\n  }\n}\n\nexport function addMilliseconds(date, amount) {\n  var timestamp = +toDate(date);\n  return constructFrom(date, timestamp + amount);\n}\n\nexport function addSeconds(date, amount) {\n  return addMilliseconds(date, amount * 1000);\n}\n\nexport function isBefore(date, dateToCompare) {\n  var _date = toDate(date);\n  var _dateToCompare = toDate(dateToCompare);\n  return +_date < +_dateToCompare;\n}\n","/**\n * Copyright (c) 2023 Anthony Mugendi\n *\n * This software is released under the MIT License.\n * https://opensource.org/licenses/MIT\n */\n'use strict';\n\nexport function arrify(v) {\n  if (v === undefined) return [];\n  return Array.isArray(v) ? v : [v];\n}\n\nexport function toDataURI(content) {\n  // ony work with blobs\n  if (content instanceof Blob == false) return Promise.resolve(content);\n\n  return new Promise(function (resolve, reject) {\n    var reader = new FileReader();\n    reader.onloadend = function () {\n      resolve(reader.result);\n    };\n    reader.readAsDataURL(content);\n  });\n}\n\nexport function injectScript(script) {\n  var tagEl;\n\n  // https://sourcemaps.info/spec.html\n  var sourceURL = `//# sourceURL=${script.url};`;\n  var content = script.content.data;\n\n  var headEl =\n    document.querySelector('head') ||\n    document.querySelector('body') ||\n    document.querySelector('html');\n\n  if (script.content.type == 'javascript') {\n    tagEl = document.createElement('script');\n    tagEl.setAttribute('type', 'text/javascript');\n    // add source url\n    content += `\\n${sourceURL}`;\n  } else if (script.content.type == 'css') {\n    tagEl = document.createElement('style');\n    tagEl.setAttribute('type', 'text/css');\n    tagEl.setAttribute('rel', 'stylesheet');\n    // add source url\n    content += `\\n/* ${sourceURL} */`;\n  }\n\n  tagEl.setAttribute('data-url', script.url);\n  tagEl.textContent = content;\n\n  headEl.appendChild(tagEl);\n\n  // return\n  return tagEl;\n}\n\n\nexport function hash(s) {\n  s = String(s);\n  var h = 0,\n    l = s.length,\n    i = 0;\n  if (l > 0) while (i < l) h = ((h << 5) - h + s.charCodeAt(i++)) | 0;\n  return 'h'+ String(h).replace('-','Z');\n}\n","/**\n * Copyright (c) 2023 Anthony Mugendi\n *\n * This software is released under the MIT License.\n * https://opensource.org/licenses/MIT\n */\n\n\"use strict\";\n\n// Reading this code? NOTE:\n// 1. This project seeks to produce the tiniest possible build (<10kb) and so a lot of corners have been cut to do so\n// 2. This project alo tries to be compatible with as many browsers as possible. As such:\n//    - Fancy stuff like async/await have been avoided and plain old Promise/Then/Catch pattern used\\\n//    - var is also used exclusively in place of let, const commands\n//    - I know I could have used polyfills and other methods to load browser-specific builds.\n//      But that's a level of complexity in use of the library I chose not to add.\n// So in case you find the code not pretty and call-back hellish, understand\n\nimport ajax from \"./lib/ajax.js\";\nimport Eev from \"./lib/events.js\";\nimport Store from \"./lib/store/index.js\";\nimport { addSeconds, isBefore } from \"./lib/utils/dateFns.js\";\nimport { getHeaderType, hasExpiredHeader } from \"./lib/utils/headers.js\";\nimport { arrify, hash, injectScript, toDataURI } from \"./lib/utils/general.js\";\n\nvar merge = Object.assign;\n\n// these characters are used in place of +ve/affirmative or the opposite statements and words\n// This is done on purpose in a bid to make this script as tiny as possible\n// For Example, we save the cache status for scripts as { \"enabled\": \"✓\", \"status\": \"✖\"}\n// This translates to : \"cache enabled\" but current status of data is that it \"was not\" read from cache.\n// One of the key goals is to make Scriptin as small as possible. A resource loader cannot be the first thing taking forever to load\nvar Y = \"✓\";\nvar N = \"✖\";\n\nclass Scriptin {\n  constructor(options = {}) {\n    this.options = merge(\n      { ttl: 0, injectToHead: true, debug: false, ignoreURLParams: true },\n      options,\n    );\n\n    this.events = new Eev();\n    this.ajax = ajax;\n    this.store = new Store();\n\n    this.__listener();\n  }\n\n  on(evs, fn) {\n    evs = arrify(evs);\n    for (var i in evs) {\n      this.events.on(evs[i], fn);\n    }\n  }\n\n  load(scripts) {\n    var self = this;\n    // console.log(12, { scripts });\n    // 1. ensure is array\n    scripts = arrify(scripts);\n    // 2. Filter & format scripts\n    var script;\n\n    for (var i in scripts) {\n      script = scripts[i];\n      // if null, skip and continue\n      if (!!script === false) continue;\n      // only use objects\n      if (typeof script == \"string\") script = { url: script };\n\n      // make script key\n      var urlKeyVal = script.url;\n\n      if (this.options.ignoreURLParams) {\n        urlKeyVal = urlKeyVal.replace(/[#\\?].+$/, \"\");\n      }\n\n      // add meta & key\n      script.meta = { key: hash(urlKeyVal) };\n\n      // 3. Now load script\n      this.__loadScript(script).then(function (script) {\n        // done loading script, emit events as necessary\n\n        if (!script) return;\n\n        self.events.emit(\"loaded\", script);\n        self.events.emit(script.url, script);\n        self.events.emit(script.content.type, script);\n        self.events.emit(script.content.category, script);\n      });\n    }\n  }\n\n  __loadScript(script) {\n    var self = this;\n    var now = new Date();\n\n    // console.log(script);\n    // if script has test and failing test, return\n    if (\"test\" in script && !!script.test === false) {\n      this.__log('\"' + script.url + '\" is skipped as the test failed.');\n      return Promise.resolve(null);\n    }\n\n    // if script\n    return this.__scriptCache(script)\n      .then(function (cachedScript) {\n        // if script is cached....\n        if (cachedScript.meta.cache.status == Y) {\n          // 1. check that cache has not expired using TTL\n          if (typeof self.options.ttl == \"number\" && self.options.ttl > 0) {\n            var cacheExpiresAt = addSeconds(\n              cachedScript.meta.fetched,\n              self.options.ttl,\n            );\n            var hasExpired = isBefore(cacheExpiresAt, now);\n\n            // if script still\n            if (hasExpired) {\n              // delete cache record\n              return self.store\n                .removeItem(cachedScript.meta.key)\n                .then(function (resp) {\n                  // returning null forces us to fectch script\n                  return null;\n                });\n            }\n          }\n\n          // 2. check that script has not been modified\n          // We do so by calling the head method on the script and comparing last-modified/maxage headers\n          self.__validateScriptCache(cachedScript);\n\n          return cachedScript;\n        }\n      })\n      .then(function (cachedScript) {\n        // ok script has not been cached.\n        // 1. if we have a cached script this fat\n        // It means the script is not only cached but the cache is valid\n        // So, return immediately\n        if (cachedScript) return cachedScript;\n\n        // 2. We got here, so fetch the script\n        // Cache script if script cache is enabled\n        return self.__fetchScript(script).then(function (resp) {\n          // if type is json, the\n          // console.log(JSON.stringify(resp, 0, 4));\n\n          script.content = resp.content;\n          script.meta.fetched = now;\n\n          // if script can be cached, then cache\n          if (script.meta.cache.enabled == Y) {\n            self.store.setItem(script.meta.key, script);\n          }\n\n          // console.log(resp.headers);\n          return script;\n        });\n      })\n      .then(function (script) {\n        // console.log(script.url, JSON.stringify(script.meta, 0, 4));\n        // console.log(JSON.stringify(script, 0, 4));\n\n        if (\n          self.options.injectToHead &&\n          (script.content.type == \"javascript\" || script.content.type == \"css\")\n        ) {\n          injectScript(script);\n        }\n\n        return script;\n      })\n      .catch(function (error) {\n        if (self.options.debug) console.error({ error });\n\n        var stack = error.stack || /*old opera*/ error.stacktrace;\n\n        var errObj = {\n          error: {\n            status: error.status || error.message,\n            details: error.statusText || stack,\n          },\n          script: script,\n        };\n\n        self.events.emit(\"error\", errObj);\n      });\n  }\n\n  __listener() {\n    let self = this;\n\n    // listen for cntrl + R\n    document.onkeydown = function KeyPress(e) {\n      // console.log(e);\n\n      KeyPress.keys = KeyPress.keys || [];\n      KeyPress.intVar = KeyPress.intVar;\n\n      clearTimeout(KeyPress.intVar);\n      KeyPress.intVar = setTimeout(function () {\n        KeyPress.keys = [];\n      }, 1000);\n\n      if (e.ctrlKey && KeyPress.keys.indexOf(\"CTRL\") == -1) {\n        KeyPress.keys.push(\"CTRL\");\n      }\n\n      if (e.code) {\n        KeyPress.keys.push(e.code);\n      }\n\n      // console.log(KeyPress.keys );\n      if (\n        KeyPress.keys.indexOf(\"KeyR\") > -1 &&\n        KeyPress.keys.indexOf(\"CTRL\") > -1\n      ) {\n        e.preventDefault();\n        self.store.clear().then(function () {\n          window.location.reload();\n        });\n      }\n    };\n\n    // Listen for dirty state\n    var intVar;\n\n    this.events.on(\"stateIsDirty\", function () {\n      //  prevent multiple reloads\n      clearTimeout(intVar);\n      intVar = setTimeout(function () {\n        window.location.reload();\n      }, 1000);\n    });\n  }\n  __validateScriptCache(script) {\n    var self = this;\n    // console.log(JSON.stringify(script, 0, 4));\n    // 1. Make head request\n    return ajax.head(script.url).then(function (resp) {\n      var headers = resp.headers;\n\n      var hasExpired = hasExpiredHeader(headers, script.meta.fetched);\n      if (hasExpired) {\n        self.__log(\n          '\"' +\n            script.url +\n            '\" has expired or been modified. Cache will be invalidated and server reloaded.',\n        );\n\n        // emit\n        self.events.emit(\"stateIsDirty\", true);\n\n        // delete from cache\n        return self.store.removeItem(script.meta.key);\n      }\n      // console.log(script.url, hasExpired);\n    });\n  }\n\n  __fetchScript(script) {\n    // ajax fetch\n    // console.log(script);\n\n    this.__log(\"fetching \", script.url);\n    // 1. if returnType == 'dataURI' then we want to set  responseType = 'blob';\n    var responseType = null;\n\n    if (script.returnType === \"dataURI\") {\n      responseType = \"blob\";\n    }\n\n    // 2.make ajax Get call\n    return ajax\n      .get(script.url, {}, { responseType: responseType })\n      .then(function (resp) {\n        // get/make data URI\n        if (script.returnType === \"dataURI\") {\n          return toDataURI(resp.data).then(function (dataURL) {\n            return merge(resp, { data: dataURL });\n          });\n        }\n\n        return resp;\n      })\n      .then(function (resp) {\n        var typeObj = {\n          type: \"?\",\n          category: \"?\",\n        };\n\n        // get content type based on headers\n        typeObj = getHeaderType(resp.headers);\n\n        var contentData = resp.data;\n\n        // if json type, then attempt to parse\n        if (typeObj.type == \"json\") {\n          try {\n            contentData = JSON.parse(contentData);\n          } catch (error) {\n            console.error(error);\n          }\n        }\n\n        contentData = merge({ data: contentData }, typeObj);\n\n        // content object and headers\n        return { content: contentData, headers: resp.headers };\n      });\n  }\n\n  // check expiry\n  __expireScriptCache(script) {\n    script.meta.expired = false;\n    return Promise.resolve(script);\n  }\n\n  // load script form cache\n  // if none is saved, return the original script\n  __scriptCache(script) {\n    script.meta.cache = { enabled: N };\n\n    // if script.cache == false\n    if (script.cache === false) {\n      // this.__log(script.url, 'not cached!');\n      return Promise.resolve(script);\n    }\n\n    // show that cache is enabled\n    script.meta.cache.enabled = Y;\n    script.meta.cache.status = N;\n\n    // this.__log(script.url, 'is cached!');\n    return this.store.getItem(script.meta.key).then(function (cachedScript) {\n      if (cachedScript) {\n        // show wer read from cache\n        cachedScript.meta.cache.status = Y;\n        return cachedScript;\n      }\n\n      return script;\n    });\n  }\n\n  __log() {\n    if (this.options.debug) console.log.apply(null, arguments);\n  }\n}\n\nexport default Scriptin;\n","/**\n * Copyright (c) 2024 Anthony Mugendi\n *\n * This software is released under the MIT License.\n * https://opensource.org/licenses/MIT\n */\n\nimport { isBefore, addSeconds } from './dateFns';\n\nexport function getHeaderType(headers) {\n  // console.log(script);\n  var contentType = (headers['content-type'] || '').toLowerCase();\n  var arr = contentType.split(';')[0].split('/');\n\n  return { category: arr[0], type: arr[1] || arr[0] };\n}\n\nexport function hasExpiredHeader(headers, dateFetched) {\n  // if last modified header\n  if (\n    headers['last-modified'] &&\n    isBefore(dateFetched, new Date(headers['last-modified']))\n  ) {\n    return true;\n  }\n\n  // use expires headers\n  if (\n    headers['expires'] &&\n    isBefore(new Date(headers['expires']), dateFetched)\n  ) {\n    // return true;\n  }\n\n  //otherwise check using max age\n  if (headers['cache-control']) {\n    var arr = headers['cache-control']\n      .split(',')\n      .map(function (v) {\n        return v.split('=');\n      })\n      .filter(function (arr) {\n        return arr.length == 2 && arr[0].indexOf('age') > -1;\n      })\n      .map(function (a) {\n        return parseInt(a[1]);\n      });\n\n    var maxAge = arr[0];\n    var expiresOn = addSeconds(dateFetched, maxAge);\n\n    if (isBefore(expiresOn, dateFetched)) {\n      return true;\n    }\n  }\n\n  return false;\n}\n"],"names":["ajax","constructor","methods","self","this","forEach","method","url","data","opts","__fetch","Promise","resolve","reject","success_callback","failure_callback","xhr","defaultOpts","headers","toUpperCase","indexOf","Object","assign","k","toLowerCase","data2","JSON","stringify","index","hasOwnProperty","length","join","XMLHttpRequest","versions","i","len","ActiveXObject","e","ua","navigator","userAgent","key","onreadystatechange","readyState","HEADERS_RECEIVED","arr","getAllResponseHeaders","trim","split","headerMap","line","parts","header","shift","value","status","onload","open","responseType","setRequestHeader","send","httpRequest","response","Eev","id","splitter","LinkedList","linkConstructor","head","RunnableLink","tail","next","reg","prev","fn","noop","events","prototype","insert","link","remove","run","on","names","me","name","list","eev","_eev","off","undefined","emit","evt","DbStorage","options","getItem","__getStore","then","store","awaitRequest","get","setItem","put","removeItem","delete","clear","__getOrCreateDb","db","transaction","objectStore","__openDb","request","indexedDB","addEventListener","result","createObjectStore","errorMessage","LocalStorage","methodName","resp","args","arguments","__formatKey","localStorage","parse","bind","Store","window","location","host","debug","initStore","webkitIndexedDB","mozIndexedDB","msIndexedDB","dbType","console","log","toDate","argument","argStr","toString","call","Date","NaN","addMilliseconds","date","amount","constructFrom","addSeconds","isBefore","dateToCompare","arrify","v","Array","isArray","hash","s","h","l","String","charCodeAt","replace","merge","Y","ttl","injectToHead","ignoreURLParams","__listener","evs","load","scripts","script","urlKeyVal","meta","__loadScript","content","type","category","now","test","__log","__scriptCache","cachedScript","cache","fetched","__validateScriptCache","__fetchScript","enabled","tagEl","sourceURL","headEl","document","querySelector","createElement","setAttribute","textContent","appendChild","injectScript","catch","error","stack","stacktrace","errObj","message","details","statusText","intVar","onkeydown","KeyPress","keys","clearTimeout","setTimeout","ctrlKey","push","code","preventDefault","reload","hasExpired","dateFetched","map","filter","a","parseInt","hasExpiredHeader","returnType","Blob","reader","FileReader","onloadend","readAsDataURL","dataURL","typeObj","contentData","__expireScriptCache","expired","apply"],"mappings":"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"}