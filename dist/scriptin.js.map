{"version":3,"file":"scriptin.js","sources":["../src/lib/utils/url.js","../src/lib/ajax.js","../src/lib/events.js","../src/lib/store/dbs/indexed-db.js","../src/lib/store/dbs/localstorage.js","../src/lib/store/index.js","../src/lib/utils/dateFns.js","../src/lib/utils/headers.js","../src/lib/utils/general.js","../src/lib/settings.js","../src/index.js"],"sourcesContent":["/**\n * Copyright (c) 2024 Anthony Mugendi\n * \n * This software is released under the MIT License.\n * https://opensource.org/licenses/MIT\n */\n\n// Scheme: https://tools.ietf.org/html/rfc3986#section-3.1\n// Absolute URL: https://tools.ietf.org/html/rfc3986#section-4.3\nconst ABSOLUTE_URL_REGEX = /^[a-zA-Z][a-zA-Z\\d+\\-.]*?:/;\n\n// Windows paths like `c:\\`\nconst WINDOWS_PATH_REGEX = /^[a-zA-Z]:\\\\/;\n\nexport default function isAbsoluteUrl(url) {\n\tif (typeof url !== 'string') {\n\t\tthrow new TypeError(`Expected a \\`string\\`, got \\`${typeof url}\\``);\n\t}\n\n\tif (WINDOWS_PATH_REGEX.test(url)) {\n\t\treturn false;\n\t}\n\n\treturn ABSOLUTE_URL_REGEX.test(url);\n}","/**\n * Copyright (c) 2023 Anthony Mugendi\n *\n * This software is released under the MIT License.\n * https://opensource.org/licenses/MIT\n */\n\nimport isAbsoluteUrl from './utils/url';\n\n// Ref:https://gist.github.com/Danilovonline/1b87ef2ff1b1e0b19714a8b2e6246856\nfunction httpRequest(\n  url,\n  method,\n  data,\n  opts,\n  success_callback,\n  failure_callback\n) {\n  var xhr;\n\n  // defaults options\n  var defaultOpts = { headers: {} };\n\n  method = method.toUpperCase();\n\n  // for post/put methods\n  if (['POST', 'PUT'].indexOf(method) > -1) {\n    defaultOpts.headers['content-type'] = 'application/json';\n  }\n\n  opts = Object.assign(defaultOpts, opts);\n\n  var headers = {};\n\n  for (var k in opts.headers) {\n    headers[k.toLowerCase()] = opts.headers[k];\n  }\n\n  var data2 = [];\n\n  if (typeof data == 'object') {\n    // format data\n    if (headers['content-type'] == 'application/json') {\n      data = JSON.stringify(data);\n    } else {\n      for (var index in data) {\n        if (data.hasOwnProperty(index)) {\n          data2[data2.length] = index + '=' + data[index];\n        }\n      }\n      data = data2.join('&');\n    }\n  }\n\n  if (typeof XMLHttpRequest !== 'undefined') {\n    xhr = new XMLHttpRequest();\n  } else {\n    var versions = [\n      'MSXML2.XmlHttp.5.0',\n      'MSXML2.XmlHttp.4.0',\n      'MSXML2.XmlHttp.3.0',\n      'MSXML2.XmlHttp.2.0',\n      'Microsoft.XmlHttp',\n    ];\n\n    for (var i = 0, len = versions.length; i < len; i++) {\n      try {\n        xhr = new ActiveXObject(versions[i]);\n        break;\n      } catch (e) {}\n    } // end for\n  }\n\n  var ua = navigator.userAgent.toLowerCase();\n\n  xhr.onreadystatechange = function () {\n    // https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/getAllResponseHeaders\n    if (this.readyState === this.HEADERS_RECEIVED) {\n      // Get the raw header string\n      var headers = xhr.getAllResponseHeaders();\n      // Convert the header string into an array\n      // of individual headers\n      var arr = headers.trim().split(/[\\r\\n]+/);\n\n      // Create a map of header names to values\n      var headerMap = {};\n      arr.forEach(function (line) {\n        var parts = line.split(': ');\n        var header = parts.shift().toLowerCase();\n        var value = parts.join(': ');\n        headerMap[header] = value;\n      });\n\n      // console.log(headerMap['content-type']);\n\n      xhr.headers = headerMap;\n    }\n  };\n\n  if (\n    ua.indexOf('msie') != -1 &&\n    ua.indexOf('opera') == -1 &&\n    ua.indexOf('webtv') == -1\n  ) {\n    xhr.onreadystatechange = function () {\n      if (this.readyState === 4) {\n        if (this.status >= 200 && this.status < 400) {\n          // Success!\n          success_callback(xhr);\n        } else {\n          // Error :(\n          failure_callback(xhr);\n        }\n      }\n    };\n  } else {\n    xhr.onload = function (e) {\n      if (this.status == 200) {\n        // console.log(xhr.data);\n        success_callback(xhr);\n      } else {\n        failure_callback(xhr);\n      }\n    };\n  }\n\n  if (!method) {\n    method = 'GET';\n  }\n\n  method = method.toUpperCase();\n\n  url = formatURL(url);\n\n  console.log(url);\n\n  xhr.open(method, url, true);\n\n  xhr.withCredentials = true;\n\n  if (opts.responseType) {\n    xhr.responseType = opts.responseType;\n  }\n\n  for (var key in headers) {\n    xhr.setRequestHeader(key, headers[key]);\n  }\n\n  xhr.send(data);\n}\n\nfunction formatURL(url) {\n  if (isAbsoluteUrl(url)) {\n    return url;\n  }\n\n  url = new URL(url, document.baseURI).href;\n\n  return url;\n}\n\nclass Ajax {\n  constructor({\n    methods = ['get', 'post', 'head', 'put', 'post', 'patch', 'delete'],\n  } = {}) {\n    var self = this;\n\n    methods.forEach(function (method) {\n      self[method] = function (url, data, opts = {}) {\n        return this.__fetch(url, method, data, opts);\n      };\n    });\n  }\n\n  __fetch(url, method, data, opts) {\n    // console.log({data});\n    return new Promise(function (resolve, reject) {\n      httpRequest(\n        url,\n        method,\n        data,\n        opts,\n        function (xhr) {\n          // console.log(\">>>>\", xhr.response==xhr.responseText);\n          // console.log(xhr);\n          resolve({ data: xhr.response, headers: xhr.headers });\n        },\n        reject\n      );\n    });\n  }\n}\n\nexport default new Ajax();\n","/**\n * Copyright (c) 2024 Anthony Mugendi\n * \n * This software is released under the MIT License.\n * https://opensource.org/licenses/MIT\n */\n\n//source: https://github.com/chrisdavies/eev\n\nexport default (function () {\n    var id = 0;\n    var splitter = /[\\s,]+/g;\n  \n    // A relatively generic LinkedList impl\n    function LinkedList(linkConstructor) {\n      this.head = new RunnableLink();\n      this.tail = new RunnableLink(this.head);\n      this.head.next = this.tail;\n      this.linkConstructor = linkConstructor;\n      this.reg = {};\n    }\n  \n    LinkedList.prototype = {\n\n      insert: function (data) {\n        var link = new RunnableLink(this.tail.prev, this.tail, data);\n        link.next.prev = link.prev.next = link;\n        return link;\n      },\n  \n      remove: function (link) {\n        link.prev.next = link.next;\n        link.next.prev = link.prev;\n      }\n    };\n  \n    // A link in the linked list which allows\n    // for efficient execution of the callbacks\n    function RunnableLink(prev, next, fn) {\n      this.prev = prev;\n      this.next = next;\n      this.fn = fn || noop;\n    }\n  \n    RunnableLink.prototype.run = function (data) {\n      this.fn(data);\n      this.next && this.next.run(data);\n    };\n  \n    function noop () { }\n  \n    function Eev () {\n      this.events = {};\n    }\n  \n    Eev.prototype = {\n      constructor: Eev,\n  \n      on: function (names, fn, ctx) {\n        var me = this;\n\n        fn = fn.bind(ctx||null);\n        // console.log('ctx', ctx);\n  \n        names.split(splitter).forEach(function (name) {\n          var list = me.events[name] || (me.events[name] = new LinkedList());\n          var eev = fn._eev || (fn._eev = (++id));\n  \n          list.reg[eev] || (list.reg[eev] = list.insert(fn));\n        });\n      },\n  \n      off: function (names, fn) {\n        var me = this;\n        fn && names.split(splitter).forEach(function (name) {\n          var list = me.events[name];\n  \n          if (!list) {\n            return;\n          }\n  \n          var link = list.reg[fn._eev];\n  \n          list.reg[fn._eev] = undefined;\n  \n          list && link && list.remove(link);\n        });\n      },\n  \n      emit: function (name, data) {\n        var evt = this.events[name];\n        evt && evt.head.run(data);\n      }\n    };\n  \n    return Eev;\n  }());","export default class DbStorage {\n  constructor(options) {\n    this.name = options.name;\n  }\n\n  async getItem(key) {\n    var store = await this.__getStore();\n    return awaitRequest(store.get(key), 'Failed to get item');\n  }\n\n  async setItem(key, value) {\n    var store = await this.__getStore();\n    return awaitRequest(store.put(value, key), 'Failed to set item');\n  }\n\n  async removeItem(key) {\n    var store = await this.__getStore();\n    return awaitRequest(store.delete(key), 'Failed to remove item');\n  }\n\n  async clear() {\n    var store = await this.__getStore();\n    return awaitRequest(store.clear(), 'Failed to clear store');\n  }\n\n  async __getStore() {\n    var db = await this.__initDb();\n    return db.transaction('store', 'readwrite').objectStore('store');\n  }\n\n  __initDb() {\n    if (this.db === undefined) {\n      this.db = this.__openDb();\n    }\n    return this.db;\n  }\n\n  __openDb() {\n    var request = indexedDB.open(this.name, 1);\n\n    request.addEventListener('upgradeneeded', function () {\n      // e.oldVersion\n      // e.newVersion\n      var db = request.result;\n      db.createObjectStore('store');\n    });\n\n    return awaitRequest(request, 'Failed to open IndexedDB');\n  }\n}\n\nfunction awaitRequest(request, errorMessage) {\n  return new Promise(function (resolve, reject) {\n    request.addEventListener('success', function () {\n      resolve(request.result);\n    });\n    request.addEventListener('error', function () {\n      reject(errorMessage);\n    });\n  });\n}\n","// wrapper for localstorage to enable domain based storage\n\nexport default class LocalStorage {\n  constructor(options) {\n    this.name = options.name;\n\n    var methods = ['getItem', 'setItem', 'removeItem', 'clear'];\n\n    for (var i in methods) {\n      this[methods[i]] = function (methodName) {\n        var args = arguments;\n        var key = this.__formatKey(args[1]);\n        var value = args[2];\n        var resp;\n\n        if (value) {\n          value = JSON.stringify(value);\n        }\n\n        if (value) {\n          resp = localStorage[methodName](key, value);\n        } else {\n          resp = localStorage[methodName](key);\n        }\n\n        if (resp) {\n          resp = JSON.parse(resp);\n        }\n\n        return resp;\n      }.bind(this, methods[i]);\n    }\n  }\n\n  __formatKey(key) {\n    return [this.name, key].join(':');\n  }\n}\n","/**\n * Copyright (c) 2024 Anthony Mugendi\n *\n * This software is released under the MIT License.\n * https://opensource.org/licenses/MIT\n */\n\n'use strict';\n\nimport DbStorage from './dbs/indexed-db.js';\nimport LocalStorage from './dbs/localstorage.js';\n\n\nclass Store {\n  constructor(options = {}) {\n    this.options = Object.assign(\n      { name: window.location.host, debug: false },\n      options\n    );\n    // initialize store\n    return this.initStore();\n  }\n\n  initStore() {\n    var indexedDB =\n      window.indexedDB ||\n      window.webkitIndexedDB ||\n      window.mozIndexedDB ||\n      window.msIndexedDB;\n\n    var db;\n\n    if (indexedDB) {\n      db = new DbStorage(this.options);\n      db.dbType = 'indexedDB';\n    } else if (window.localStorage) {\n      db = new LocalStorage(this.options);\n      db.dbType = 'localStorage';\n    }\n\n    if (this.options.debug) {\n      console.log(`Database Used: `, db.dbType);\n    }\n\n    return db;\n  }\n}\n\nexport default Store;\n","export function toDate(argument) {\n  var argStr = Object.prototype.toString.call(argument);\n\n  // Clone the date\n  if (\n    argument instanceof Date ||\n    (typeof argument === 'object' && argStr === '[object Date]')\n  ) {\n    // Prevent the date to lose the milliseconds when passed to new Date() in IE10\n    return new argument.constructor(+argument);\n  } else if (\n    typeof argument === 'number' ||\n    argStr === '[object Number]' ||\n    typeof argument === 'string' ||\n    argStr === '[object String]'\n  ) {\n    // TODO: Can we get rid of as?\n    return new Date(argument);\n  } else {\n    // TODO: Can we get rid of as?\n    return new Date(NaN);\n  }\n}\n\nexport function constructFrom(date, value) {\n  if (date instanceof Date) {\n    return new date.constructor(value);\n  } else {\n    return new Date(value);\n  }\n}\n\nexport function addMilliseconds(date, amount) {\n  var timestamp = +toDate(date);\n  return constructFrom(date, timestamp + amount);\n}\n\nexport function addSeconds(date, amount) {\n  return addMilliseconds(date, amount * 1000);\n}\n\nexport function isBefore(date, dateToCompare) {\n  var _date = toDate(date);\n  var _dateToCompare = toDate(dateToCompare);\n  return +_date < +_dateToCompare;\n}\n","/**\n * Copyright (c) 2024 Anthony Mugendi\n *\n * This software is released under the MIT License.\n * https://opensource.org/licenses/MIT\n */\n\nimport { isBefore, addSeconds } from './dateFns';\n\nexport function getHeaderType(headers) {\n  // console.log(script);\n  var contentType = (headers['content-type'] || '').toLowerCase();\n  var arr = contentType.split(';')[0].split('/');\n\n  return { category: arr[0] || \"?\", type: arr[1] || arr[0] || \"?\" };\n}\n\nexport function hasExpiredHeader(headers, dateFetched) {\n  // if last modified header\n  if (\n    headers['last-modified'] &&\n    isBefore(dateFetched, new Date(headers['last-modified']))\n  ) {\n    return true;\n  }\n\n  // use expires headers\n  if (\n    headers['expires'] &&\n    isBefore(new Date(headers['expires']), dateFetched)\n  ) {\n    // return true;\n  }\n\n  //otherwise check using max age\n  if (headers['cache-control']) {\n    var arr = headers['cache-control']\n      .split(',')\n      .map(function (v) {\n        return v.split('=');\n      })\n      .filter(function (arr) {\n        return arr.length == 2 && arr[0].indexOf('age') > -1;\n      })\n      .map(function (a) {\n        return parseInt(a[1]);\n      });\n\n    var maxAge = arr[0];\n    var expiresOn = addSeconds(dateFetched, maxAge);\n\n    if (isBefore(expiresOn, dateFetched)) {\n      return true;\n    }\n  }\n\n  return false;\n}\n","/**\n * Copyright (c) 2023 Anthony Mugendi\n *\n * This software is released under the MIT License.\n * https://opensource.org/licenses/MIT\n */\n'use strict';\n\nexport function arrify(v) {\n  if (v === undefined) return [];\n  return Array.isArray(v) ? v : [v];\n}\n\nexport function toDataURI(content) {\n  // ony work with blobs\n  if (content instanceof Blob == false) return Promise.resolve(content);\n\n  return new Promise(function (resolve, reject) {\n    var reader = new FileReader();\n    reader.onloadend = function () {\n      resolve(reader.result);\n    };\n    reader.readAsDataURL(content);\n  });\n}\n\nexport function injectScript(script) {\n  var tagEl;\n\n  // https://sourcemaps.info/spec.html\n  var sourceURL = `//# sourceURL=${script.url};`;\n  var content = script.content.data;\n\n  var headEl =\n    document.querySelector('head') ||\n    document.querySelector('body') ||\n    document.querySelector('html');\n\n\n  if (script.content.type == 'javascript') {\n    tagEl = document.createElement('script');\n    tagEl.setAttribute('type', 'text/javascript');\n    // add source url\n    content += `\\n${sourceURL}`;\n  } else if (script.content.type == 'css') {\n    tagEl = document.createElement('style');\n    tagEl.setAttribute('type', 'text/css');\n    tagEl.setAttribute('rel', 'stylesheet');\n    // add source url\n    content += `\\n/* ${sourceURL} */`;\n  }\n\n  tagEl.setAttribute('data-url', script.url);\n  tagEl.textContent = content;\n\n  headEl.appendChild(tagEl);\n\n  // return\n  return tagEl;\n}\n\n\nexport function delay (time=1000) {\n   return new Promise((resolve) => setTimeout(resolve, time));\n}\n\nexport function hash(s) {\n  s = String(s);\n  var h = 0,\n    l = s.length,\n    i = 0;\n  if (l > 0) while (i < l) h = ((h << 5) - h + s.charCodeAt(i++)) | 0;\n  return 'h' + String(h).replace('-', 'Z');\n}\n\nexport function merge(target, source) {\n  // Iterate through `source` properties and if an `Object` set property to merge of `target` and `source` properties\n  for (var key of Object.keys(source)) {\n    if (source[key] instanceof Object)\n      Object.assign(source[key], merge(target[key] || {}, source[key]));\n  }\n\n  // Join `target` and modified `source`\n  Object.assign(target || {}, source);\n  return target;\n}\n\n\nexport function getHost() {\n  // obtain plugin path from the script element\n  var src;\n  var path = '/scriptin.js';\n\n  if (document.currentScript) {\n    src = document.currentScript.src;\n  } else {\n    var sel = document.querySelector('script[src$=\"'+path+'\"]')\n    if (sel) {\n      src = sel.src;\n    }\n  }\n\n\n  return src.replace(path,'');\n}\n\n\nexport function isClass(val) {\n  if(!val) return false\n  var propertyNames = Object.getOwnPropertyNames(val);\n  return propertyNames.includes('prototype') && !propertyNames.includes('arguments');\n}\n\nexport function isFunction(val) {\n  return typeof val === 'function' && !isClass(val);\n}\n\nexport function isAbsoluteURL(url){\n  return /^(?:[a-z+]+:)?\\/\\//.test(url)\n}\n\nexport function titleCase(str) {\n  str = str.toLowerCase().split(' ');\n  for (var i = 0; i < str.length; i++) {\n    str[i] = str[i].charAt(0).toUpperCase() + str[i].slice(1); \n  }\n  return str.join(' ');\n}","/**\n * Copyright (c) 2024 Anthony Mugendi\n *\n * This software is released under the MIT License.\n * https://opensource.org/licenses/MIT\n */\n\nexport const pluginsOrder = ['IsLoading', 'Details', 'AutoResource'];\n","/**\n * Copyright (c) 2023 Anthony Mugendi\n *\n * This software is released under the MIT License.\n * https://opensource.org/licenses/MIT\n */\n\n\"use strict\";\n\nimport ajax from \"./lib/ajax.js\";\nimport Eev from \"./lib/events.js\";\nimport Store from \"./lib/store/index.js\";\nimport { addSeconds, isBefore } from \"./lib/utils/dateFns.js\";\nimport { getHeaderType, hasExpiredHeader } from \"./lib/utils/headers.js\";\nimport {\n  arrify,\n  getHost,\n  hash,\n  injectScript,\n  isAbsoluteURL,\n  isClass,\n  merge,\n  toDataURI,\n} from \"./lib/utils/general.js\";\nimport { pluginsOrder } from \"./lib/settings.js\";\n\n// these characters are used in place of +ve/affirmative or the opposite statements and words\n// This is done on purpose in a bid to make this script as tiny as possible\n// For Example, we save the cache status for scripts as { \"enabled\": \"✓\", \"status\": \"✖\"}\n// This translates to : \"cache enabled\" but current status of data is that it \"was not\" read from cache.\n// One of the key goals is to make Scriptin as small as possible. A resource loader cannot be the first thing taking forever to load\nvar Y = \"✓\";\nvar N = \"✖\";\n\nvar scriptHost = getHost();\n\nclass Scriptin {\n  constructor(options = {}) {\n    this.scriptHost = scriptHost;\n\n    this.options = merge(\n      { ttl: 0, injectToHead: true, debug: false, ignoreURLParams: true },\n      options,\n    );\n\n    this.events = new Eev();\n    this.ajax = ajax;\n    this.store = new Store();\n\n    this.Scriptin = this;\n\n    this.__init();\n    this.loadedPlugins = {};\n  }\n\n  __init() {\n    this.__listener();\n    this.__init_plugins();\n  }\n\n  on(evs, fn) {\n    evs = arrify(evs);\n    for (var i in evs) {\n      this.events.on(evs[i], fn);\n    }\n  }\n\n  async load(scripts, options) {\n    try {\n      var self = this;\n      // console.log(12, { scripts });\n      // 1. ensure is array\n      scripts = arrify(scripts);\n      // 2. Filter & format scripts\n      var script;\n\n      var promises = [];\n\n      // load each script\n      for (var i in scripts) {\n        script = scripts[i];\n        // if null, skip and continue\n        if (!!script === false) continue;\n        // only use objects\n        if (typeof script == \"string\") script = { url: script };\n\n        // make script key\n        var urlKeyVal = script.url;\n\n        if (this.options.ignoreURLParams) {\n          urlKeyVal = urlKeyVal.replace(/[#\\?].+$/, \"\");\n        }\n\n        // default cache to true\n        script.cache = script.cache === false ? false : true;\n        // default ttl to script.ttl or options.ttl or 0\n        script.ttl = script.ttl || this.options.ttl || 0;\n        // add meta & key\n        script.meta = { key: hash(urlKeyVal) };\n\n        // 3. Now load script\n        var loadedScript = await this.__loadScript(script);\n\n        promises.push(loadedScript);\n\n        if (loadedScript) {\n          var event = options?.event || \"loaded\";\n          var parent = options?.parent;\n\n          loadedScript.parent = parent;\n\n          self.events.emit(event, loadedScript);\n          self.events.emit(loadedScript.url, loadedScript);\n          self.events.emit(loadedScript.content.type, loadedScript);\n          self.events.emit(loadedScript.content.category, loadedScript);\n        }\n      }\n\n      return await Promise.all(promises).then((resp) => {\n        var obj = {};\n        for (var i in resp) {\n          obj[resp[i].url] = resp[i];\n        }\n\n        return obj;\n      });\n    } catch (error) {\n      // Handle all errors\n\n      if (self?.options?.debug) console.error({ error });\n\n      var stack = error.stack || /*old opera*/ error.stacktrace;\n      var errObj = {\n        error: {\n          status: error.status || error.message,\n          details: error.statusText || stack,\n        },\n        script: script,\n      };\n\n      self.events.emit(\"error\", errObj);\n    }\n  }\n\n  async __init_plugins() {\n    var self = this;\n    try {\n      self.pluginsLoaded = self.pluginsLoaded || [];\n\n      // load\n      self.events.on(\"plugin-loaded\", async function (script) {\n        var name = script.url.split(\"/\").pop().replace(/\\.js$/, \"\");\n        var cName = \"ScriptIn\" + name;\n        var cls = window[cName];\n        var parent = script.parent;\n\n        if (isClass(cls)) {\n          // pass all methods of Scriptin class\n\n          let plugin = new cls(merge(self, { pluginName: name, parent }));\n\n          if (plugin.dependencies) {\n            var deps = arrify(plugin.dependencies);\n\n            // do not load existing deps\n            // console.log(deps, self.pluginsLoaded);\n            // load plugin deps\n            await self.__loadPlugins(deps, name);\n          }\n\n          // init\n          plugin.init && plugin.init();\n        }\n      });\n\n      // order plugins properly\n      var pluginsObjKeys = Object.keys(this.options.plugins);\n      var plugins = pluginsOrder.filter((p) => pluginsObjKeys.indexOf(p) > -1);\n\n      // load plugins\n      await this.__loadPlugins(plugins);\n\n      // await\n    } catch (error) {\n      console.error(error);\n    }\n  }\n\n  async __loadPlugins(plugins, parent) {\n    var plugin;\n\n    //\n    for (var i in plugins) {\n      plugin = plugins[i];\n\n      var url;\n\n      // load plugin from absolute link too\n      if (isAbsoluteURL(plugins[i])) {\n        url = plugins[i];\n      } else {\n        url = this.scriptHost + \"/plugins/\" + plugin + \".js\";\n      }\n\n      if (this.pluginsLoaded.indexOf(url) > -1) continue;\n\n      this.pluginsLoaded.push(url);\n\n      await this.load(url, { event: \"plugin-loaded\", parent });\n    }\n  }\n\n  async __loadScript(script) {\n    var self = this;\n    var now = new Date();\n\n    script.meta.cache = { enabled: N };\n\n    // if script has test and failing test, return\n    if (\"test\" in script && !!script.test === false) {\n      this.__log('\"' + script.url + '\" is skipped as the test failed.');\n      return null;\n    }\n\n    // if script.cache\n    if (script.cache) {\n      // show that cache is enabled\n      script.meta.cache.enabled = Y;\n      script.meta.cache.status = N;\n\n      // this.__log(script.url, 'is cached!');\n      var cachedScript = await this.store.getItem(script.meta.key);\n\n      if (cachedScript) {\n        var cacheStatusDirty = false;\n        // now we have a script cached\n        // But there are conditions which would make us reject this cache status. These are\n        // 1.ttl has not changed\n        cacheStatusDirty = script.ttl !== cachedScript.ttl;\n\n        // 2. script.returnType has changed\n        cacheStatusDirty = script.returnType !== cachedScript.returnType;\n\n        if (!cacheStatusDirty) {\n          // set cache status to Y\n          script.meta.cache.status = Y;\n          script = merge(cachedScript, script);\n        }\n      }\n    }\n\n    // if script is cached....\n    if (script.meta.cache.status == Y) {\n      // Check that cache has not expired using TTL\n      if (\n        typeof script.ttl == \"number\" &&\n        script.ttl > 0 &&\n        script.meta.fetched\n      ) {\n        var cacheExpiresAt = addSeconds(script.meta.fetched, script.ttl);\n        var hasExpired = isBefore(cacheExpiresAt, now);\n\n        // if script still\n        if (hasExpired) {\n          // delete cache record\n          await self.store.removeItem(script.meta.key);\n          // toggle cached status\n          script.meta.cache.status = N;\n          // delete content property\n          delete script.content;\n        }\n      }\n\n      // 2. check that script has not been modified\n      // We do so by calling the head method on the script and comparing last-modified/maxage headers\n      self.__validateCache(script);\n    }\n\n    // If not cached...\n    if (script.meta.cache.status == N) {\n      // We got here, so fetch the script\n      // Cache script if script cache is enabled\n      var resp = await self.__fetchScript(script);\n\n      var contentLength = parseFloat(resp.headers[\"content-length\"]) || null;\n\n      // console.log(JSON.stringify(resp.headers,0,4));\n      script.content = resp.content;\n      script.meta.fetched = now;\n      script.meta.size = contentLength;\n\n      // if script can be cached, then cache\n      if (script.meta.cache.enabled == Y) {\n        self.store.setItem(script.meta.key, script);\n      }\n    }\n\n    // Inject to header if need be\n    if (\n      self.options.injectToHead &&\n      (script.content.type == \"javascript\" || script.content.type == \"css\")\n    ) {\n      injectScript(script);\n    }\n\n    // return script\n    return script;\n  }\n\n  __listener() {\n    var self = this;\n\n    // listen for cntrl + R\n    async function KeyPress(e) {\n      // console.log(e);\n      // e.preventDefault();\n\n      KeyPress.keys = KeyPress.keys || [];\n      KeyPress.intVar = KeyPress.intVar;\n\n      clearTimeout(KeyPress.intVar);\n      KeyPress.intVar = setTimeout(function () {\n        KeyPress.keys = [];\n      }, 1000);\n\n      if (e.ctrlKey && KeyPress.keys.indexOf(\"CTRL\") == -1) {\n        KeyPress.keys.push(\"CTRL\");\n      }\n\n      if (e.code) {\n        KeyPress.keys.push(e.code);\n      }\n\n      // console.log(KeyPress.keys);\n\n      if (\n        KeyPress.keys.indexOf(\"KeyR\") > -1 &&\n        KeyPress.keys.indexOf(\"CTRL\") > -1\n      ) {\n        e.preventDefault();\n        await self.store.clear();\n        window.location.reload();\n      }\n    }\n\n    document.addEventListener(\"keydown\", KeyPress);\n\n    // Listen for dirty state\n    var intVar;\n\n    this.events.on(\"stateIsDirty\", function () {\n      //  prevent multiple reloads\n      clearTimeout(intVar);\n      intVar = setTimeout(function () {\n        window.location.reload();\n      }, 1000);\n    });\n  }\n\n  async __validateCache(script) {\n    var self = this;\n    // console.log(JSON.stringify(script, 0, 4));\n    // 1. Make head request\n    var resp = await ajax.head(script.url);\n    var hasExpired = hasExpiredHeader(resp.headers, script.meta.fetched);\n\n    if (hasExpired) {\n      self.__log(\n        '\"' +\n          script.url +\n          '\" has expired or been modified. Cache will be invalidated and server reloaded.',\n      );\n\n      // emit\n      self.events.emit(\"stateIsDirty\", true);\n\n      // delete from cache\n      await self.store.removeItem(script.meta.key);\n    }\n  }\n\n  async __fetchScript(script) {\n    // ajax fetch\n\n    this.__log(\"fetching \", script.url);\n    // 1. if returnType == 'dataURI' then we want to set  responseType = 'blob';\n    var responseType = null;\n    var isDataURI = script.returnType === \"dataURI\";\n    if (isDataURI) {\n      responseType = \"blob\";\n    }\n\n    // 2.make ajax Get request\n    var resp = await ajax.get(script.url, {}, { responseType: responseType });\n\n    // get/make data URI\n    if (isDataURI) {\n      var dataURL = await toDataURI(resp.data);\n      resp = merge(resp, { data: dataURL });\n    }\n\n    // get content type based on headers\n    var typeObj = getHeaderType(resp.headers);\n    var contentData = resp.data;\n\n    // if json type, then attempt to parse\n    if (typeObj.type == \"json\") {\n      try {\n        contentData = JSON.parse(contentData);\n      } catch (error) {\n        console.error(error);\n      }\n    }\n\n    contentData = merge({ data: contentData }, typeObj);\n\n    // content object and headers\n    return { content: contentData, headers: resp.headers };\n  }\n\n  __log() {\n    if (this.options.debug) console.log.apply(null, arguments);\n  }\n}\n\nexport default Scriptin;\n"],"names":["ABSOLUTE_URL_REGEX","WINDOWS_PATH_REGEX","isAbsoluteUrl","url","TypeError","test","httpRequest","method","data","opts","success_callback","failure_callback","xhr","defaultOpts","headers","toUpperCase","indexOf","Object","assign","k","toLowerCase","data2","JSON","stringify","index","hasOwnProperty","length","join","XMLHttpRequest","versions","i","len","ActiveXObject","e","ua","navigator","userAgent","onreadystatechange","readyState","HEADERS_RECEIVED","getAllResponseHeaders","arr","trim","split","headerMap","forEach","line","parts","header","shift","value","status","onload","formatURL","console","log","open","withCredentials","responseType","key","setRequestHeader","send","URL","document","baseURI","href","Ajax","constructor","methods","self","__fetch","Promise","resolve","reject","response","id","splitter","LinkedList","linkConstructor","head","RunnableLink","tail","next","reg","prototype","insert","link","prev","remove","fn","noop","run","Eev","events","on","names","ctx","me","bind","name","list","eev","_eev","off","undefined","emit","evt","DbStorage","options","getItem","_this","_asyncToGenerator","store","__getStore","awaitRequest","get","setItem","_this2","put","removeItem","_this3","delete","clear","_this4","_this5","db","__initDb","transaction","objectStore","__openDb","request","indexedDB","addEventListener","result","createObjectStore","errorMessage","LocalStorage","methodName","args","arguments","__formatKey","resp","localStorage","parse","Store","window","location","host","debug","initStore","webkitIndexedDB","mozIndexedDB","msIndexedDB","dbType","toDate","argument","argStr","toString","call","_instanceof","Date","NaN","constructFrom","date","addMilliseconds","amount","timestamp","addSeconds","isBefore","dateToCompare","_date","_dateToCompare","getHeaderType","contentType","category","type","hasExpiredHeader","dateFetched","map","v","filter","a","parseInt","maxAge","expiresOn","arrify","Array","isArray","toDataURI","content","Blob","reader","FileReader","onloadend","readAsDataURL","injectScript","script","tagEl","sourceURL","headEl","querySelector","createElement","setAttribute","textContent","appendChild","hash","s","String","h","l","charCodeAt","replace","merge","target","source","keys","getHost","src","path","currentScript","sel","isClass","val","propertyNames","getOwnPropertyNames","includes","isAbsoluteURL","pluginsOrder","Y","N","scriptHost","Scriptin","ttl","injectToHead","ignoreURLParams","ajax","__init","loadedPlugins","__listener","__init_plugins","evs","load","scripts","promises","urlKeyVal","cache","meta","loadedScript","__loadScript","push","event","parent","all","then","obj","error","_self$options","stack","stacktrace","errObj","message","details","statusText","pluginsLoaded","_ref","pop","cName","cls","plugin","pluginName","dependencies","deps","__loadPlugins","init","_x","apply","pluginsObjKeys","plugins","p","now","enabled","__log","cachedScript","cacheStatusDirty","returnType","fetched","cacheExpiresAt","hasExpired","__validateCache","__fetchScript","contentLength","parseFloat","size","KeyPress","_x2","_KeyPress","intVar","clearTimeout","setTimeout","ctrlKey","code","preventDefault","reload","_this6","isDataURI","dataURL","typeObj","contentData"],"mappings":"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"}