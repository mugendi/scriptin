{"version":3,"file":"Details.js","sources":["../../src/lib/utils/general.js","../../node_modules/pretty-bytes/index.js","../../src/plugins/Details.js"],"sourcesContent":["/**\n * Copyright (c) 2023 Anthony Mugendi\n *\n * This software is released under the MIT License.\n * https://opensource.org/licenses/MIT\n */\n'use strict';\n\nexport function arrify(v) {\n  if (v === undefined) return [];\n  return Array.isArray(v) ? v : [v];\n}\n\nexport function toDataURI(content) {\n  // ony work with blobs\n  if (content instanceof Blob == false) return Promise.resolve(content);\n\n  return new Promise(function (resolve, reject) {\n    var reader = new FileReader();\n    reader.onloadend = function () {\n      resolve(reader.result);\n    };\n    reader.readAsDataURL(content);\n  });\n}\n\nexport function injectScript(script) {\n  var tagEl;\n\n  // https://sourcemaps.info/spec.html\n  var sourceURL = `//# sourceURL=${script.url};`;\n  var content = script.content.data;\n\n  var headEl =\n    document.querySelector('head') ||\n    document.querySelector('body') ||\n    document.querySelector('html');\n\n\n  if (script.content.type == 'javascript') {\n    tagEl = document.createElement('script');\n    tagEl.setAttribute('type', 'text/javascript');\n    // add source url\n    content += `\\n${sourceURL}`;\n  } else if (script.content.type == 'css') {\n    tagEl = document.createElement('style');\n    tagEl.setAttribute('type', 'text/css');\n    tagEl.setAttribute('rel', 'stylesheet');\n    // add source url\n    content += `\\n/* ${sourceURL} */`;\n  }\n\n  tagEl.setAttribute('data-url', script.url);\n  tagEl.textContent = content;\n\n  headEl.appendChild(tagEl);\n\n  // return\n  return tagEl;\n}\n\n\nexport function delay (time=1000) {\n   return new Promise((resolve) => setTimeout(resolve, time));\n}\n\nexport function hash(s) {\n  s = String(s);\n  var h = 0,\n    l = s.length,\n    i = 0;\n  if (l > 0) while (i < l) h = ((h << 5) - h + s.charCodeAt(i++)) | 0;\n  return 'h' + String(h).replace('-', 'Z');\n}\n\nexport function merge(target, source) {\n  // Iterate through `source` properties and if an `Object` set property to merge of `target` and `source` properties\n  for (var key of Object.keys(source)) {\n    if (source[key] instanceof Object)\n      Object.assign(source[key], merge(target[key] || {}, source[key]));\n  }\n\n  // Join `target` and modified `source`\n  Object.assign(target || {}, source);\n  return target;\n}\n\n\nexport function getHost() {\n  // obtain plugin path from the script element\n  var src;\n  var path = '/scriptin.js';\n\n  if (document.currentScript) {\n    src = document.currentScript.src;\n  } else {\n    var sel = document.querySelector('script[src$=\"'+path+'\"]')\n    if (sel) {\n      src = sel.src;\n    }\n  }\n\n\n  return src.replace(path,'');\n}\n\n\nexport function isClass(val) {\n  if(!val) return false\n  var propertyNames = Object.getOwnPropertyNames(val);\n  return propertyNames.includes('prototype') && !propertyNames.includes('arguments');\n}\n\nexport function isFunction(val) {\n  return typeof val === 'function' && !isClass(val);\n}\n\nexport function isAbsoluteURL(url){\n  return /^(?:[a-z+]+:)?\\/\\//.test(url)\n}\n\nexport function titleCase(str) {\n  str = str.toLowerCase().split(' ');\n  for (var i = 0; i < str.length; i++) {\n    str[i] = str[i].charAt(0).toUpperCase() + str[i].slice(1); \n  }\n  return str.join(' ');\n}","const BYTE_UNITS = [\n\t'B',\n\t'kB',\n\t'MB',\n\t'GB',\n\t'TB',\n\t'PB',\n\t'EB',\n\t'ZB',\n\t'YB',\n];\n\nconst BIBYTE_UNITS = [\n\t'B',\n\t'KiB',\n\t'MiB',\n\t'GiB',\n\t'TiB',\n\t'PiB',\n\t'EiB',\n\t'ZiB',\n\t'YiB',\n];\n\nconst BIT_UNITS = [\n\t'b',\n\t'kbit',\n\t'Mbit',\n\t'Gbit',\n\t'Tbit',\n\t'Pbit',\n\t'Ebit',\n\t'Zbit',\n\t'Ybit',\n];\n\nconst BIBIT_UNITS = [\n\t'b',\n\t'kibit',\n\t'Mibit',\n\t'Gibit',\n\t'Tibit',\n\t'Pibit',\n\t'Eibit',\n\t'Zibit',\n\t'Yibit',\n];\n\n/*\nFormats the given number using `Number#toLocaleString`.\n- If locale is a string, the value is expected to be a locale-key (for example: `de`).\n- If locale is true, the system default locale is used for translation.\n- If no value for locale is specified, the number is returned unmodified.\n*/\nconst toLocaleString = (number, locale, options) => {\n\tlet result = number;\n\tif (typeof locale === 'string' || Array.isArray(locale)) {\n\t\tresult = number.toLocaleString(locale, options);\n\t} else if (locale === true || options !== undefined) {\n\t\tresult = number.toLocaleString(undefined, options);\n\t}\n\n\treturn result;\n};\n\nexport default function prettyBytes(number, options) {\n\tif (!Number.isFinite(number)) {\n\t\tthrow new TypeError(`Expected a finite number, got ${typeof number}: ${number}`);\n\t}\n\n\toptions = {\n\t\tbits: false,\n\t\tbinary: false,\n\t\tspace: true,\n\t\t...options,\n\t};\n\n\tconst UNITS = options.bits\n\t\t? (options.binary ? BIBIT_UNITS : BIT_UNITS)\n\t\t: (options.binary ? BIBYTE_UNITS : BYTE_UNITS);\n\n\tconst separator = options.space ? ' ' : '';\n\n\tif (options.signed && number === 0) {\n\t\treturn ` 0${separator}${UNITS[0]}`;\n\t}\n\n\tconst isNegative = number < 0;\n\tconst prefix = isNegative ? '-' : (options.signed ? '+' : '');\n\n\tif (isNegative) {\n\t\tnumber = -number;\n\t}\n\n\tlet localeOptions;\n\n\tif (options.minimumFractionDigits !== undefined) {\n\t\tlocaleOptions = {minimumFractionDigits: options.minimumFractionDigits};\n\t}\n\n\tif (options.maximumFractionDigits !== undefined) {\n\t\tlocaleOptions = {maximumFractionDigits: options.maximumFractionDigits, ...localeOptions};\n\t}\n\n\tif (number < 1) {\n\t\tconst numberString = toLocaleString(number, options.locale, localeOptions);\n\t\treturn prefix + numberString + separator + UNITS[0];\n\t}\n\n\tconst exponent = Math.min(Math.floor(options.binary ? Math.log(number) / Math.log(1024) : Math.log10(number) / 3), UNITS.length - 1);\n\tnumber /= (options.binary ? 1024 : 1000) ** exponent;\n\n\tif (!localeOptions) {\n\t\tnumber = number.toPrecision(3);\n\t}\n\n\tconst numberString = toLocaleString(Number(number), options.locale, localeOptions);\n\n\tconst unit = UNITS[exponent];\n\n\treturn prefix + numberString + separator + unit;\n}\n","/**\n * Copyright (c) 2024 Anthony Mugendi\n *\n * This software is released under the MIT License.\n * https://opensource.org/licenses/MIT\n */\n\nimport { titleCase } from '../lib/utils/general';\nimport prettyBytes from 'pretty-bytes';\nimport css from '../styles/plugins/details.css';\n\nexport default class Plugin {\n  constructor(ctx) {\n    // inherit Scriptin (this.Scriptin) context which we will need\n    Object.assign(this, ctx);\n\n    this.dependencies = ['__styler', 'AutoResource'];\n    this.pluginOptions = this.options?.plugins?.Details || {};\n\n  }\n\n  init() {\n    // Inject styles\n    this.Scriptin.injectStyles && this.Scriptin.injectStyles(css);\n\n    // addDetails\n    this.addDetails();\n  }\n\n  makeFilter() {\n    var filter = this.pluginOptions.filter || null;\n\n    // must be an array\n    if (Array.isArray(filter) === false) {\n      filter = null;\n    }\n\n    if (filter) {\n      for (var i in filter) {\n        let arr = filter[i].split('.');\n        if (arr.length == 1) {\n          arr.push(arr[0] + '.*');\n        }\n        arr.forEach((v) => {\n          if (filter.indexOf(v) == -1) {\n            filter.push(v);\n          }\n        });\n      }\n    }\n\n    if (filter?.length == 0) {\n      filter = null;\n    }\n\n    return filter;\n  }\n\n  addDetails() {\n    var filter = this.makeFilter();\n    var showHeaders = this.pluginOptions.showHeaders;\n\n    if (showHeaders == undefined) {\n      showHeaders = true;\n    }\n\n\n    // Listen for load event\n    this.Scriptin.events.on(\n      'loaded',\n      function (script) {\n        // log\n        if (script.returnType == 'dataURI') {\n          var el = document.querySelector(\n            '[data-scriptin=\"' + script.url + '\"]'\n          );\n\n          if (!el) return;\n\n          var containerEl = document.createElement('div');\n          containerEl.setAttribute('class', 'scriptin-details');\n\n          var details = {\n            meta: {\n              type: script.content.type,\n              category: script.content.category,\n              size: script.meta.size,\n            },\n            cache: {\n              isHot: script.meta.cache.status == 'âœ“',\n            },\n            file: {\n              url: script.url,\n              name: script.url.split('/').pop(),\n            },\n          };\n\n          for (var i in details) {\n            var key = i;\n\n            if (filter?.indexOf(key) == -1) continue;\n\n            var groupEl = document.createElement('div');\n\n            groupEl.setAttribute('class', 'scriptin-details-group');\n\n            var html = '';\n\n            if (showHeaders) {\n              html =\n                html +\n                '<h4 class=\"scriptin-details-category\">' +\n                titleCase(i) +\n                '</h4>';\n            }\n\n            html = html + '<ul>';\n\n            for (var j in details[i]) {\n              var key = i + '.' + j;\n\n              if (filter?.indexOf(key) == -1 && filter?.indexOf(i + '.*') == -1)\n                continue;\n\n              if (key == 'meta.size') {\n                details[i][j] = prettyBytes(details[i][j]);\n              }\n\n              html =\n                html +\n                '<li>' +\n                '<strong>' +\n                titleCase(j) +\n                ': </strong> ' +\n                '<span>' +\n                details[i][j] +\n                '</span>' +\n                '</li>';\n            }\n\n            html = html + '</ul>';\n\n            groupEl.innerHTML = html;\n            containerEl.appendChild(groupEl);\n          }\n\n          \n          //   console.log(JSON.stringify(details, 0, 4));\n          el.after(containerEl);\n        }\n      },\n      {}\n    );\n  }\n}\n"],"names":["titleCase","str","toLowerCase","split","i","length","charAt","toUpperCase","slice","join","BYTE_UNITS","BIBYTE_UNITS","BIT_UNITS","BIBIT_UNITS","toLocaleString","number","locale","options","result","Array","isArray","undefined","prettyBytes","Number","isFinite","TypeError","UNITS","bits","binary","space","separator","signed","isNegative","prefix","localeOptions","minimumFractionDigits","maximumFractionDigits","exponent","Math","min","floor","log","log10","toPrecision","constructor","ctx","_this$options","Object","assign","this","dependencies","pluginOptions","plugins","Details","init","Scriptin","injectStyles","addDetails","makeFilter","_filter","filter","arr","push","forEach","v","indexOf","showHeaders","events","on","script","returnType","el","document","querySelector","url","containerEl","createElement","setAttribute","details","meta","type","content","category","size","cache","isHot","status","file","name","pop","key","groupEl","html","j","innerHTML","appendChild","after"],"mappings":"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","x_google_ignoreList":[1]}