{"version":3,"file":"AutoResource.js","sources":["../../src/plugins/AutoResource.js"],"sourcesContent":["/**\n * Copyright (c) 2024 Anthony Mugendi\n *\n * This software is released under the MIT License.\n * https://opensource.org/licenses/MIT\n */\n\nexport default class Plugin {\n  constructor(ctx) {\n    // inherit Scriptin (this.Scriptin) context which we will need\n    Object.assign(this, ctx);\n\n    this.dependencies = ['IsLoading'];\n  }\n\n  init() {\n    // load resources\n    this.loadResources();\n  }\n\n  async loadResources() {\n    // select all elements\n    var els = Object.values(document.querySelectorAll('[data-scriptin]'));\n\n    // loop through and handle each element\n    for (var i in els) {\n      var el = els[i];\n\n      try {\n        this.loadElement(el);\n      } catch (error) {\n        console.error(error);\n      }\n    }\n  }\n\n  loadElement(el) {\n    var self = this;\n    // only supported tags\n    // if not, an error is thrown\n    this.isSupportedTag(el);\n\n    // get dataset\n    var data = el.dataset;\n    // avoid loading twice\n    if (data.scriptinLoading) return;\n\n    // get url\n    var url = data.scriptin;\n\n    el.setAttribute('data-scriptin-loading', 'true');\n\n    // make script data for our call\n    var script = { url };\n    // merge all other data attributes other than scriptin\n    for (var j in data) {\n      if (j == 'scriptin') continue;\n      script[j] = data[j] || true;\n    }\n\n    // set returnType\n    script.returnType = script.returnType || 'dataURI';\n\n    // only deal with dataURI's\n    if (script.returnType !== 'dataURI') {\n      throw (\n        'Remove [data-return-type] or set it to \"dataURI\" from: ' +\n        this.printEl(el)\n      );\n    }\n\n    // Listen for load event\n    this.Scriptin.events.on(\n      url,\n      function (script) {\n        // log\n        // self.Scriptin.__log( el.dataset.scriptin, 'Ready');\n        if (script.content.data instanceof Blob) {\n          self.options.debug && console.error('Unexpected Blob Data Format. ');\n        } else {\n          this.el.setAttribute('src', script.content.data);\n          el.classList.remove('scriptin-loading');\n          el.removeAttribute('data-scriptin-loading');\n\n          if (self.hideLoader && typeof self.hideLoader == 'function') {\n            self.hideLoader(el);\n          }\n        }\n      },\n      { el }\n    );\n\n    // show loading\n    el.classList.add('scriptin-loading');\n    // if the showLoaderMethod is available\n    if (this.showLoader && typeof this.showLoader == 'function') {\n      this.showLoader(el);\n    }\n\n    // load script\n    this.Scriptin.load(script);\n  }\n\n  printEl(el) {\n    console.log('object');\n    var div = document.createElement('div');\n    div.appendChild(el);\n    return div.innerHTML;\n  }\n\n  isSupportedTag(el) {\n    var tag = el.tagName.toLowerCase();\n    var allowedTags = ['img', 'audio', 'video'];\n    if (allowedTags.indexOf(tag) > -1) return true;\n    // else throw\n    throw (\n      '<' +\n      el.tagName.toLowerCase() +\n      '> elements not a supported. Use one of ' +\n      allowedTags.map((e) => '<' + e + '>').join(', ')\n    );\n  }\n}\n"],"names":["Plugin","constructor","ctx","Object","assign","dependencies","init","loadResources","_this","_asyncToGenerator","els","values","document","querySelectorAll","i","el","loadElement","error","console","self","isSupportedTag","data","dataset","scriptinLoading","url","scriptin","setAttribute","script","j","returnType","printEl","Scriptin","events","on","_instanceof","content","Blob","options","debug","classList","remove","removeAttribute","hideLoader","add","showLoader","load","log","div","createElement","appendChild","innerHTML","tag","tagName","toLowerCase","allowedTags","indexOf","map","e","join"],"mappings":"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"}