{"version":3,"file":"AutoResource.js","sources":["../../src/plugins/AutoResource.js"],"sourcesContent":["/**\n * Copyright (c) 2024 Anthony Mugendi\n *\n * This software is released under the MIT License.\n * https://opensource.org/licenses/MIT\n */\n\nexport default class Plugin {\n  constructor(ctx) {\n    // inherit Scriptin (this.Scriptin) context which we will need\n    Object.assign(this, ctx);\n\n    this.dependencies = ['IsLoading'];\n  }\n\n  init() {\n    // load resources\n    this.loadResources();\n  }\n\n  async loadResources() {\n    // select all elements\n    var els = Object.values(document.querySelectorAll('[data-scriptin]'));\n\n    // loop through and handle each element\n    for (var i in els) {\n      var el = els[i];\n\n      try {\n        this.loadElement(el);\n      } catch (error) {\n        console.error(error);\n      }\n    }\n  }\n\n  loadElement(el) {\n    var self = this;\n    // only supported tags\n    // if not, an error is thrown\n    this.isSupportedTag(el);\n\n    // get dataset\n    var data = el.dataset;\n    // avoid loading twice\n    if (data.scriptinLoading) return;\n\n    // get url\n    var url = data.scriptin;\n\n    el.setAttribute('data-scriptin-loading', 'true');\n\n    // make script data for our call\n    var script = { url };\n    // merge all other data attributes other than scriptin\n    for (var j in data) {\n      if (j == 'scriptin') continue;\n      script[j] = data[j] || true;\n    }\n\n    // set returnType\n    script.returnType = script.returnType || 'dataURI';\n\n    // only deal with dataURI's\n    if (script.returnType !== 'dataURI') {\n      throw (\n        'Remove [data-return-type] or set it to \"dataURI\" from: ' +\n        this.printEl(el)\n      );\n    }\n\n    // Listen for load event\n    this.Scriptin.events.on(\n      url,\n      function (script) {\n        // log\n        // self.Scriptin.__log( el.dataset.scriptin, 'Ready');\n        if (script.content.data instanceof Blob) {\n          self.options.debug && console.error('Unexpected Blob Data Format. ');\n        } else {\n          this.el.setAttribute('src', script.content.data);\n          el.classList.remove('scriptin-loading');\n          el.removeAttribute('data-scriptin-loading');\n\n          if (self.hideLoader && typeof self.hideLoader == 'function') {\n            self.hideLoader(el);\n          }\n        }\n      },\n      { el }\n    );\n\n    // show loading\n    el.classList.add('scriptin-loading');\n    // if the showLoaderMethod is available\n    if (this.showLoader && typeof this.showLoader == 'function') {\n      this.showLoader(el);\n    }\n\n    // load script\n    this.Scriptin.load(script);\n  }\n\n  printEl(el) {\n    console.log('object');\n    var div = document.createElement('div');\n    div.appendChild(el);\n    return div.innerHTML;\n  }\n\n  isSupportedTag(el) {\n    var tag = el.tagName.toLowerCase();\n    var allowedTags = ['img', 'audio', 'video'];\n    if (allowedTags.indexOf(tag) > -1) return true;\n    // else throw\n    throw (\n      '<' +\n      el.tagName.toLowerCase() +\n      '> elements not a supported. Use one of ' +\n      allowedTags.map((e) => '<' + e + '>').join(', ')\n    );\n  }\n}\n"],"names":["constructor","ctx","Object","assign","this","dependencies","init","loadResources","_this","els","values","document","querySelectorAll","i","el","loadElement","error","console","self","isSupportedTag","data","dataset","scriptinLoading","url","scriptin","setAttribute","script","j","returnType","printEl","Scriptin","events","on","content","Blob","options","debug","classList","remove","removeAttribute","hideLoader","add","showLoader","load","log","div","createElement","appendChild","innerHTML","tag","tagName","toLowerCase","allowedTags","indexOf","map","e","join"],"mappings":"iLAOe,MACbA,WAAAA,CAAYC,GAEVC,OAAOC,OAAOC,KAAMH,GAEpBG,KAAKC,aAAe,CAAC,YACvB,CAEAC,IAAAA,GAEEF,KAAKG,eACP,CAEMA,aAAAA,GAAgB,MAAAC,EAAAJ,KAAA,SAAA,YAEpB,IAAIK,EAAMP,OAAOQ,OAAOC,SAASC,iBAAiB,oBAGlD,IAAK,IAAIC,KAAKJ,EAAK,CACjB,IAAIK,EAAKL,EAAII,GAEb,IACEL,EAAKO,YAAYD,EAClB,CAAC,MAAOE,GACPC,QAAQD,MAAMA,EAChB,CACF,CAAC,kLACH,CAEAD,WAAAA,CAAYD,GACV,IAAII,EAAOd,KAGXA,KAAKe,eAAeL,GAGpB,IAAIM,EAAON,EAAGO,QAEd,IAAID,EAAKE,gBAAT,CAGA,IAAIC,EAAMH,EAAKI,SAEfV,EAAGW,aAAa,wBAAyB,QAGzC,IAAIC,EAAS,CAAEH,IAAAA,GAEf,IAAK,IAAII,KAAKP,EACH,YAALO,IACJD,EAAOC,GAAKP,EAAKO,KAAM,GAOzB,GAHAD,EAAOE,WAAaF,EAAOE,YAAc,UAGf,YAAtBF,EAAOE,WACT,KACE,0DACAxB,KAAKyB,QAAQf,GAKjBV,KAAK0B,SAASC,OAAOC,GACnBT,GACA,SAAUG,aAGJA,EAAOO,QAAQb,eAAgBc,kGACjChB,EAAKiB,QAAQC,OAASnB,QAAQD,MAAM,kCAEpCZ,KAAKU,GAAGW,aAAa,MAAOC,EAAOO,QAAQb,MAC3CN,EAAGuB,UAAUC,OAAO,oBACpBxB,EAAGyB,gBAAgB,yBAEfrB,EAAKsB,YAAwC,mBAAnBtB,EAAKsB,YACjCtB,EAAKsB,WAAW1B,GAGtB,GACA,CAAEA,GAAAA,IAIJA,EAAGuB,UAAUI,IAAI,oBAEbrC,KAAKsC,YAAwC,mBAAnBtC,KAAKsC,YACjCtC,KAAKsC,WAAW5B,GAIlBV,KAAK0B,SAASa,KAAKjB,EAvDO,CAwD5B,CAEAG,OAAAA,CAAQf,GACNG,QAAQ2B,IAAI,UACZ,IAAIC,EAAMlC,SAASmC,cAAc,OAEjC,OADAD,EAAIE,YAAYjC,GACT+B,EAAIG,SACb,CAEA7B,cAAAA,CAAeL,GACb,IAAImC,EAAMnC,EAAGoC,QAAQC,cACjBC,EAAc,CAAC,MAAO,QAAS,SACnC,GAAIA,EAAYC,QAAQJ,IAAQ,EAAG,OAAO,EAE1C,KACE,IACAnC,EAAGoC,QAAQC,cACX,0CACAC,EAAYE,KAAI,SAACC,GAAC,MAAK,IAAMA,EAAI,GAAG,IAAEC,KAAK,KAE/C"}