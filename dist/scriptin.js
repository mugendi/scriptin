var ScriptIn=function(){"use strict";function e(e,t,n,r,i,o,s){try{var a=e[o](s),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function t(t){return function(){var n=this,r=arguments;return new Promise((function(i,o){var s=t.apply(n,r);function a(t){e(s,i,o,a,c,"next",t)}function c(t){e(s,i,o,a,c,"throw",t)}a(void 0)}))}}function n(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):e instanceof t}const r=/^[a-zA-Z][a-zA-Z\d+\-.]*?:/,i=/^[a-zA-Z]:\\/;function o(e,t,n,o,s,a){var c,u={headers:{"Access-Control-Allow-Origin":"*"}};t=t.toUpperCase(),["POST","PUT"].indexOf(t)>-1&&(u.headers["content-type"]="application/json"),o=Object.assign(u,o);var l={};for(var d in o.headers)l[d.toLowerCase()]=o.headers[d];var p=[];if("object"==typeof n)if("application/json"==l["content-type"])n=JSON.stringify(n);else{for(var f in n)n.hasOwnProperty(f)&&(p[p.length]=f+"="+n[f]);n=p.join("&")}if("undefined"!=typeof XMLHttpRequest)c=new XMLHttpRequest;else for(var h=["MSXML2.XmlHttp.5.0","MSXML2.XmlHttp.4.0","MSXML2.XmlHttp.3.0","MSXML2.XmlHttp.2.0","Microsoft.XmlHttp"],v=0,y=h.length;v<y;v++)try{c=new ActiveXObject(h[v]);break}catch(e){}var m=navigator.userAgent.toLowerCase();for(var g in c.onreadystatechange=function(){if(this.readyState===this.HEADERS_RECEIVED){var e=c.getAllResponseHeaders().trim().split(/[\r\n]+/),t={};e.forEach((function(e){var n=e.split(": "),r=n.shift().toLowerCase(),i=n.join(": ");t[r]=i})),c.headers=t}},-1!=m.indexOf("msie")&&-1==m.indexOf("opera")&&-1==m.indexOf("webtv")?c.onreadystatechange=function(){4===this.readyState&&(this.status>=200&&this.status<400?s(c):a(c))}:c.onload=function(e){200==this.status?s(c):a(c)},t||(t="GET"),t=t.toUpperCase(),e=function(e){if(function(e){if("string"!=typeof e)throw new TypeError(`Expected a \`string\`, got \`${typeof e}\``);return!i.test(e)&&r.test(e)}(e))return e;return e=new URL(e,document.baseURI).href,e}(e),c.open(t,e,!0),o.responseType&&(c.responseType=o.responseType),l)c.setRequestHeader(g,l[g]);c.send(n)}var s=new class{constructor({methods:e=["get","post","head","put","post","patch","delete"]}={}){var t=this;e.forEach((function(e){t[e]=function(t,n,r={}){return this.__fetch(t,e,n,r)}}))}__fetch(e,t,n,r){return new Promise((function(i,s){o(e,t,n,r,(function(e){i({data:e.response,headers:e.headers})}),s)}))}},a=function(){var e=0,t=/[\s,]+/g;function n(e){this.head=new r,this.tail=new r(this.head),this.head.next=this.tail,this.linkConstructor=e,this.reg={}}function r(e,t,n){this.prev=e,this.next=t,this.fn=n||i}function i(){}function o(){this.events={}}return n.prototype={insert:function(e){var t=new r(this.tail.prev,this.tail,e);return t.next.prev=t.prev.next=t,t},remove:function(e){e.prev.next=e.next,e.next.prev=e.prev}},r.prototype.run=function(e){this.fn(e),this.next&&this.next.run(e)},o.prototype={constructor:o,on:function(r,i,o){var s=this;i=i.bind(o||null),r.split(t).forEach((function(t){var r=s.events[t]||(s.events[t]=new n),o=i._eev||(i._eev=++e);r.reg[o]||(r.reg[o]=r.insert(i))}))},off:function(e,n){var r=this;n&&e.split(t).forEach((function(e){var t=r.events[e];if(t){var i=t.reg[n._eev];t.reg[n._eev]=void 0,t&&i&&t.remove(i)}}))},emit:function(e,t){var n=this.events[e];n&&n.head.run(t)}},o}();class c{constructor(e){this.name=e.name}getItem(e){var n=this;return t((function*(){return u((yield n.__getStore()).get(e),"Failed to get item")}))()}setItem(e,n){var r=this;return t((function*(){return u((yield r.__getStore()).put(n,e),"Failed to set item")}))()}removeItem(e){var n=this;return t((function*(){return u((yield n.__getStore()).delete(e),"Failed to remove item")}))()}clear(){var e=this;return t((function*(){return u((yield e.__getStore()).clear(),"Failed to clear store")}))()}__getStore(){var e=this;return t((function*(){return(yield e.__initDb()).transaction("store","readwrite").objectStore("store")}))()}__initDb(){return void 0===this.db&&(this.db=this.__openDb()),this.db}__openDb(){var e=indexedDB.open(this.name,1);return e.addEventListener("upgradeneeded",(function(){e.result.createObjectStore("store")})),u(e,"Failed to open IndexedDB")}}function u(e,t){return new Promise((function(n,r){e.addEventListener("success",(function(){n(e.result)})),e.addEventListener("error",(function(){r(t)}))}))}class l{constructor(e){this.name=e.name;var t=["getItem","setItem","removeItem","clear"];for(var n in t)this[t[n]]=function(e){var t,n=arguments,r=this.__formatKey(n[1]),i=n[2];return i&&(i=JSON.stringify(i)),(t=i?localStorage[e](r,i):localStorage[e](r))&&(t=JSON.parse(t)),t}.bind(this,t[n])}__formatKey(e){return[this.name,e].join(":")}}class d{constructor(e={}){return this.options=Object.assign({name:window.location.host,debug:!1},e),this.initStore()}initStore(){var e;return window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB||window.msIndexedDB?(e=new c(this.options)).dbType="indexedDB":window.localStorage&&((e=new l(this.options)).dbType="localStorage"),this.options.debug&&console.log("Database Used: ",e.dbType),e}}function p(e){var t=Object.prototype.toString.call(e);return n(e,Date)||"object"==typeof e&&"[object Date]"===t?new e.constructor(+e):"number"==typeof e||"[object Number]"===t||"string"==typeof e||"[object String]"===t?new Date(e):new Date(NaN)}function f(e,t){return function(e,t){return n(e,Date)?new e.constructor(t):new Date(t)}(e,+p(e)+t)}function h(e,t){return f(e,1e3*t)}function v(e,t){return+p(e)<+p(t)}function y(e){return void 0===e?[]:Array.isArray(e)?e:[e]}function m(e){var t=0,n=(e=String(e)).length,r=0;if(n>0)for(;r<n;)t=(t<<5)-t+e.charCodeAt(r++)|0;return"h"+String(t).replace("-","Z")}function g(e,t){for(var r of Object.keys(t))n(t[r],Object)&&Object.assign(t[r],g(e[r]||{},t[r]));return Object.assign(e||{},t),e}function _(e){return/^(?:[a-z+]+:)?\/\//.test(e)}const w=["IsLoading","Details","AutoResource"];var b="✓",S="✖",x=function(){var e,t="/scriptin.js";if(document.currentScript)e=document.currentScript.src;else{var n=document.querySelector('script[src$="'+t+'"]');n&&(e=n.src)}return e.replace(t,"")}();return class{constructor(e={}){this.scriptHost=x,this.options=g({ttl:0,injectToHead:!0,debug:!1,ignoreURLParams:!0,plugins:{}},e),this.events=new a,this.ajax=s,this.store=new d,this.Scriptin=this,this.__init(),this.loadedPlugins={}}__init(){this.__listener(),this.__init_plugins()}on(e,t){for(var n in e=y(e))this.events.on(e[n],t)}load(e,n){var r=this;return t((function*(){try{var t,i=r;e=y(e);var o=[];for(var s in e)if(!1!=!!(t=e[s])){"string"==typeof t&&(t={url:t});var a=t.url;r.options.ignoreURLParams&&(a=a.replace(/[#\?].+$/,"")),t.cache=!1!==t.cache,t.ttl=t.ttl||r.options.ttl||0,t.meta={key:m(a)};var c=yield r.__loadScript(t);if(o.push(c),c){var u=(null==n?void 0:n.event)||"loaded",l=null==n?void 0:n.parent;c.parent=l,i.events.emit(u,c),i.events.emit(c.url,c),i.events.emit(c.content.type,c),i.events.emit(c.content.category,c)}}return yield Promise.all(o).then((function(e){var t={};for(var n in e)t[e[n].url]=e[n];return t}))}catch(e){var d;null!=i&&null!==(d=i.options)&&void 0!==d&&d.debug&&console.error({error:e});var p=e.stack||e.stacktrace,f={error:{status:e.status||e.message,details:e.statusText||p},script:t};i.events.emit("error",f)}}))()}__init_plugins(){var e=this;return t((function*(){var n=e;try{n.pluginsLoaded=n.pluginsLoaded||[],n.events.on("plugin-loaded",function(){var e=t((function*(e){var t=e.url.split("/").pop().replace(/\.js$/,""),r=window["ScriptIn"+t],i=e.parent;if(function(e){if(!e)return!1;var t=Object.getOwnPropertyNames(e);return t.includes("prototype")&&!t.includes("arguments")}(r)){let e=new r(g(n,{pluginName:t,parent:i}));if(e.dependencies){var o=y(e.dependencies);yield n.__loadPlugins(o,t)}e.init&&e.init()}}));return function(t){return e.apply(this,arguments)}}());var r=Object.keys(e.options.plugins),i=w.filter((function(e){return r.indexOf(e)>-1}));yield e.__loadPlugins(i)}catch(e){console.error(e)}}))()}__loadPlugins(e,n){var r=this;return t((function*(){var t;for(var i in e){var o;t=e[i],o=_(e[i])?e[i]:r.scriptHost+"/plugins/"+t+".js",r.pluginsLoaded.indexOf(o)>-1||(r.pluginsLoaded.push(o),yield r.load(o,{event:"plugin-loaded",parent:n}))}}))()}__loadScript(e){var n=this;return t((function*(){var t=n,r=new Date;if(e.meta.cache={enabled:S},"test"in e&&!1==!!e.test)return n.__log('"'+e.url+'" is skipped as the test failed.'),null;if(e.cache){e.meta.cache.enabled=b,e.meta.cache.status=S;var i=yield n.store.getItem(e.meta.key);if(i){e.ttl!==i.ttl,e.returnType!==i.returnType||(e.meta.cache.status=b,e=g(i,e))}}if(e.meta.cache.status==b){if("number"==typeof e.ttl&&e.ttl>0&&e.meta.fetched)v(h(e.meta.fetched,e.ttl),r)&&(yield t.store.removeItem(e.meta.key),e.meta.cache.status=S,delete e.content);t.__validateCache(e)}if(e.meta.cache.status==S){var o=yield t.__fetchScript(e),s=parseFloat(o.headers["content-length"])||null;e.content=o.content,e.meta.fetched=r,e.meta.size=s,e.meta.cache.enabled==b&&t.store.setItem(e.meta.key,e)}return!t.options.injectToHead||"javascript"!=e.content.type&&"css"!=e.content.type||function(e){var t,n=`//# sourceURL=${e.url};`,r=e.content.data,i=document.querySelector("head")||document.querySelector("body")||document.querySelector("html");"javascript"==e.content.type?((t=document.createElement("script")).setAttribute("type","text/javascript"),r+=`\n${n}`):"css"==e.content.type&&((t=document.createElement("style")).setAttribute("type","text/css"),t.setAttribute("rel","stylesheet"),r+=`\n/* ${n} */`),t.setAttribute("data-url",e.url),t.textContent=r,i.appendChild(t)}(e),e}))()}__listener(){var e,n=this;function r(e){return i.apply(this,arguments)}function i(){return(i=t((function*(e){r.keys=r.keys||[],r.intVar=r.intVar,clearTimeout(r.intVar),r.intVar=setTimeout((function(){r.keys=[]}),1e3),e.ctrlKey&&-1==r.keys.indexOf("CTRL")&&r.keys.push("CTRL"),e.code&&r.keys.push(e.code),r.keys.indexOf("KeyR")>-1&&r.keys.indexOf("CTRL")>-1&&(e.preventDefault(),yield n.store.clear(),window.location.reload())}))).apply(this,arguments)}document.addEventListener("keydown",r),this.events.on("stateIsDirty",(function(){clearTimeout(e),e=setTimeout((function(){window.location.reload()}),1e3)}))}__validateCache(e){var n=this;return t((function*(){var t,r,i=n,o=yield s.head(e.url);(t=o.headers,r=e.meta.fetched,!!(t["last-modified"]&&v(r,new Date(t["last-modified"]))||(t.expires&&v(new Date(t.expires),r),t["cache-control"]&&v(h(r,t["cache-control"].split(",").map((function(e){return e.split("=")})).filter((function(e){return 2==e.length&&e[0].indexOf("age")>-1})).map((function(e){return parseInt(e[1])}))[0]),r))))&&(i.__log('"'+e.url+'" has expired or been modified. Cache will be invalidated and server reloaded.'),i.events.emit("stateIsDirty",!0),yield i.store.removeItem(e.meta.key))}))()}__fetchScript(e){var r=this;return t((function*(){r.__log("fetching ",e.url);var t=null,i="dataURI"===e.returnType;i&&(t="blob");var o,a=yield s.get(e.url,{},{responseType:t});i&&(a=g(a,{data:yield(o=a.data,0==n(o,Blob)?Promise.resolve(o):new Promise((function(e,t){var n=new FileReader;n.onloadend=function(){e(n.result)},n.readAsDataURL(o)})))}));var c,u,l=(c=a.headers,{category:(u=(c["content-type"]||"").toLowerCase().split(";")[0].split("/"))[0]||"?",type:u[1]||u[0]||"?"}),d=a.data;if("json"==l.type)try{d=JSON.parse(d)}catch(e){console.error(e)}return{content:d=g({data:d},l),headers:a.headers}}))()}__log(){this.options.debug&&console.log.apply(null,arguments)}}}();
//# sourceMappingURL=scriptin.js.map
