var Scriptin=function(){"use strict";var e=new class{constructor({methods:e=["get","post","head","put","post"]}={}){var t=this;e.forEach((function(e){t[e]=function(t,n,r={}){return this.__fetch(t,e,n,r)}}))}__fetch(e,t,n,r){return new Promise((function(o,i){!function(e,t,n,r,o,i){var s,a={headers:{}};t=t.toUpperCase(),["POST","PUT"].indexOf(t)>-1&&(a.headers["content-type"]="application/json"),r=Object.assign(a,r);var c={};for(var u in r.headers)c[u.toLowerCase()]=r.headers[u];var d=[];if("object"==typeof n)if("application/json"==c["content-type"])n=JSON.stringify(n);else{for(var h in n)n.hasOwnProperty(h)&&(d[d.length]=h+"="+n[h]);n=d.join("&")}if("undefined"!=typeof XMLHttpRequest)s=new XMLHttpRequest;else for(var l=["MSXML2.XmlHttp.5.0","MSXML2.XmlHttp.4.0","MSXML2.XmlHttp.3.0","MSXML2.XmlHttp.2.0","Microsoft.XmlHttp"],p=0,f=l.length;p<f;p++)try{s=new ActiveXObject(l[p]);break}catch(e){}var v=navigator.userAgent.toLowerCase();for(var m in s.onreadystatechange=function(){if(this.readyState===this.HEADERS_RECEIVED){var e=s.getAllResponseHeaders().trim().split(/[\r\n]+/),t={};e.forEach((function(e){var n=e.split(": "),r=n.shift().toLowerCase(),o=n.join(": ");t[r]=o})),s.headers=t}},-1!=v.indexOf("msie")&&-1==v.indexOf("opera")&&-1==v.indexOf("webtv")?s.onreadystatechange=function(){4===this.readyState&&(this.status>=200&&this.status<400?o(s):i(s))}:s.onload=function(e){200==this.status?o(s):i(s)},t||(t="GET"),t=t.toUpperCase(),s.open(t,e,!0),r.responseType&&(s.responseType=r.responseType),c)s.setRequestHeader(m,c[m]);s.send(n)}(e,t,n,r,(function(e){o({data:e.response,headers:e.headers})}),i)}))}},t=function(){var e=0,t=/[\s,]+/g;function n(e){this.head=new r,this.tail=new r(this.head),this.head.next=this.tail,this.linkConstructor=e,this.reg={}}function r(e,t,n){this.prev=e,this.next=t,this.fn=n||o}function o(){}function i(){this.events={}}return n.prototype={insert:function(e){var t=new r(this.tail.prev,this.tail,e);return t.next.prev=t.prev.next=t,t},remove:function(e){e.prev.next=e.next,e.next.prev=e.prev}},r.prototype.run=function(e){this.fn(e),this.next&&this.next.run(e)},i.prototype={constructor:i,on:function(r,o){var i=this;r.split(t).forEach((function(t){var r=i.events[t]||(i.events[t]=new n),s=o._eev||(o._eev=++e);r.reg[s]||(r.reg[s]=r.insert(o))}))},off:function(e,n){var r=this;n&&e.split(t).forEach((function(e){var t=r.events[e];if(t){var o=t.reg[n._eev];t.reg[n._eev]=void 0,t&&o&&t.remove(o)}}))},emit:function(e,t){var n=this.events[e];n&&n.head.run(t)}},i}();class n{constructor(e){this.name=e.name}getItem(e){return this.__getStore().then((t=>r(t.get(e),"Failed to get item")))}setItem(e,t){return this.__getStore().then((n=>r(n.put(t,e),"Failed to set item")))}removeItem(e){return this.__getStore().then((t=>r(t.delete(e),"Failed to remove item")))}clear(){return this.__getStore().then((e=>r(e.clear(),"Failed to clear store")))}__getStore(){return this.__getOrCreateDb().then((e=>e.transaction("store","readwrite").objectStore("store")))}__getOrCreateDb(){return void 0===this.db&&(this.db=this.__openDb()),this.db}__openDb(){var e=indexedDB.open(this.name,1);return e.addEventListener("upgradeneeded",(function(){e.result.createObjectStore("store")})),r(e,"Failed to open IndexedDB")}}function r(e,t){return new Promise((function(n,r){e.addEventListener("success",(function(){n(e.result)})),e.addEventListener("error",(function(){r(t)}))}))}class o{constructor(e){this.name=e.name;var t=["getItem","setItem","removeItem","clear"];for(var n in t)this[t[n]]=function(e){var t,n=arguments,r=this.__formatKey(n[1]),o=n[2];return o&&(o=JSON.stringify(o)),(t=o?localStorage[e](r,o):localStorage[e](r))&&(t=JSON.parse(t)),t}.bind(this,t[n])}__formatKey(e){return[this.name,e].join(":")}}class i{constructor(e={}){return this.options=Object.assign({name:window.location.host,debug:!1},e),this.initStore()}initStore(){var e;return window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB||window.msIndexedDB?(e=new n(this.options)).dbType="indexedDB":window.localStorage&&((e=new o(this.options)).dbType="localStorage"),this.options.debug&&console.log("Database Used: ",e.dbType),e}}function s(e){var t=Object.prototype.toString.call(e);return e instanceof Date||"object"==typeof e&&"[object Date]"===t?new e.constructor(+e):"number"==typeof e||"[object Number]"===t||"string"==typeof e||"[object String]"===t?new Date(e):new Date(NaN)}function a(e,t){return function(e,t){return e instanceof Date?new e.constructor(t):new Date(t)}(e,+s(e)+t)}function c(e,t){return a(e,1e3*t)}function u(e,t){return+s(e)<+s(t)}function d(e){return void 0===e?[]:Array.isArray(e)?e:[e]}function h(e){var t=0,n=(e=String(e)).length,r=0;if(n>0)for(;r<n;)t=(t<<5)-t+e.charCodeAt(r++)|0;return"h"+String(t).replace("-","Z")}var l=Object.assign,p="✓";return class{constructor(n={}){this.options=l({ttl:0,injectToHead:!0,debug:!1,ignoreURLParams:!0},n),this.events=new t,this.ajax=e,this.store=new i,this.__listener()}on(e,t){for(var n in e=d(e))this.events.on(e[n],t)}load(e){var t,n=this;for(var r in e=d(e))if(!1!=!!(t=e[r])){"string"==typeof t&&(t={url:t});var o=t.url;this.options.ignoreURLParams&&(o=o.replace(/[#\?].+$/,"")),t.meta={key:h(o)},this.__loadScript(t).then((function(e){e&&(n.events.emit("loaded",e),n.events.emit(e.url,e),n.events.emit(e.content.type,e),n.events.emit(e.content.category,e))}))}}__loadScript(e){var t=this,n=new Date;return"test"in e&&!1==!!e.test?(this.__log('"'+e.url+'" is skipped as the test failed.'),Promise.resolve(null)):this.__scriptCache(e).then((function(e){if(e.meta.cache.status==p){if("number"==typeof t.options.ttl&&t.options.ttl>0)if(u(c(e.meta.fetched,t.options.ttl),n))return t.store.removeItem(e.meta.key).then((function(e){return null}));return t.__validateScriptCache(e),e}})).then((function(r){return r||t.__fetchScript(e).then((function(r){return e.content=r.content,e.meta.fetched=n,e.meta.cache.enabled==p&&t.store.setItem(e.meta.key,e),e}))})).then((function(e){return!t.options.injectToHead||"javascript"!=e.content.type&&"css"!=e.content.type||function(e){var t,n=`//# sourceURL=${e.url};`,r=e.content.data,o=document.querySelector("head")||document.querySelector("body")||document.querySelector("html");"javascript"==e.content.type?((t=document.createElement("script")).setAttribute("type","text/javascript"),r+=`\n${n}`):"css"==e.content.type&&((t=document.createElement("style")).setAttribute("type","text/css"),t.setAttribute("rel","stylesheet"),r+=`\n/* ${n} */`),t.setAttribute("data-url",e.url),t.textContent=r,o.appendChild(t)}(e),e})).catch((function(n){t.options.debug&&console.error({error:n});var r=n.stack||n.stacktrace,o={error:{status:n.status||n.message,details:n.statusText||r},script:e};t.events.emit("error",o)}))}__listener(){let e=this;var t;document.onkeydown=function t(n){t.keys=t.keys||[],t.intVar=t.intVar,clearTimeout(t.intVar),t.intVar=setTimeout((function(){t.keys=[]}),1e3),n.ctrlKey&&-1==t.keys.indexOf("CTRL")&&t.keys.push("CTRL"),n.code&&t.keys.push(n.code),t.keys.indexOf("KeyR")>-1&&t.keys.indexOf("CTRL")>-1&&(n.preventDefault(),e.store.clear().then((function(){window.location.reload()})))},this.events.on("stateIsDirty",(function(){clearTimeout(t),t=setTimeout((function(){window.location.reload()}),1e3)}))}__validateScriptCache(t){var n=this;return e.head(t.url).then((function(e){var r=function(e,t){return!(!e["last-modified"]||!u(t,new Date(e["last-modified"])))||(e.expires&&u(new Date(e.expires),t),!(!e["cache-control"]||!u(c(t,e["cache-control"].split(",").map((function(e){return e.split("=")})).filter((function(e){return 2==e.length&&e[0].indexOf("age")>-1})).map((function(e){return parseInt(e[1])}))[0]),t)))}(e.headers,t.meta.fetched);if(r)return n.__log('"'+t.url+'" has expired or been modified. Cache will be invalidated and server reloaded.'),n.events.emit("stateIsDirty",!0),n.store.removeItem(t.meta.key)}))}__fetchScript(t){this.__log("fetching ",t.url);var n=null;return"dataURI"===t.returnType&&(n="blob"),e.get(t.url,{},{responseType:n}).then((function(e){return"dataURI"===t.returnType?(n=e.data,n instanceof Blob==0?Promise.resolve(n):new Promise((function(e,t){var r=new FileReader;r.onloadend=function(){e(r.result)},r.readAsDataURL(n)}))).then((function(t){return l(e,{data:t})})):e;var n})).then((function(e){var t,n,r={type:"?",category:"?"};t=e.headers,r={category:(n=(t["content-type"]||"").toLowerCase().split(";")[0].split("/"))[0],type:n[1]||n[0]};var o=e.data;if("json"==r.type)try{o=JSON.parse(o)}catch(e){console.error(e)}return{content:o=l({data:o},r),headers:e.headers}}))}__expireScriptCache(e){return e.meta.expired=!1,Promise.resolve(e)}__scriptCache(e){return e.meta.cache={enabled:"✖"},!1===e.cache?Promise.resolve(e):(e.meta.cache.enabled=p,e.meta.cache.status="✖",this.store.getItem(e.meta.key).then((function(t){return t?(t.meta.cache.status=p,t):e})))}__log(){this.options.debug&&console.log.apply(null,arguments)}}}();
//# sourceMappingURL=scriptin.js.map
